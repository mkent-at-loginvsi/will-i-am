"use strict";(self.webpackChunkAutomationMachine=self.webpackChunkAutomationMachine||[]).push([[827],{98827:(Vo,ee,s)=>{s.r(ee),s.d(ee,{CollectionsModule:()=>Ro});var S=s(36895),Se=s(151),we=s(59890),Te=s(82038),h=s(24006),Q=s(89502),v=s(14353);class d{static getCollectionUrl(a){return`${d.collectionsUrl}/${a}`}static getCollectionInfoUrl(a){return`${d.getCollectionUrl(a)}/${d.collectionInfoPath}`}}d.collectionsPath="collections",d.collectionInfoPath="info",d.configurationPath="config",d.activeDirectoryPath="ad",d.collectionsUrl=`/${d.collectionsPath}`,d.configurationUrl=`${d.collectionsUrl}/${d.configurationPath}`,d.adConfigurationUrl=`${d.configurationUrl}/${d.activeDirectoryPath}`;var M=s(12320),q=s(34645),w=s(42654),C=s(69096),xe=s(28981),A=s(65938),I=s(97315),Ze=s(21113),J=s(17530),Me=s(9699),e=s(94650),Y=s(17974),te=s(45863),k=s(31491),Ae=s(98653),D=s(4859);let ye=(()=>{class i{constructor(t,o,n,l){this.importId=t,this.dialog=o,this.messageDialogService=n,this.importService=l,this.progressModel=new Ze.a,this.closeAction=new q.r,this.progressState=I.I,this.subscription=new w.w,this.progressModel.mode="determinate",this.closeAction.tooltipTitle="Close",this.closeAction.icon=M.R.icons.fontAwesome.TIMES_REGULAR,this.closeAction.action=this.handleClose.bind(this)}ngOnInit(){const t=this.importService.subscribeToTaskProgress(this.importId).subscribe(n=>{this.progressModel.text=n.text,this.progressModel.progressValue=n.progress,this.progressModel.state=!0===n.failed?I.I.Failed:n.state});this.subscription.add(t);const o=this.importService.subscribeToTaskCompletion(this.importId).subscribe(n=>{n.resultType===J.C.Succeeded&&(this.importedCollectionId=n.data),this.mapState(n.resultType)});this.subscription.add(o)}mapState(t){switch(t){case J.C.Succeeded:case J.C.SucceededWithWarnings:this.progressModel.state=I.I.Succeeded;break;case J.C.Failed:this.progressModel.state=I.I.Failed}}handleClose(){this.closeDialog("Progress can only be tracked from this page, if you navigate away you will not be able to follow the progress anymore. Are you sure you want to navigate away?")}closeDialog(t){if(this.progressModel.state===I.I.Started||this.progressModel.state===I.I.Unstarted){const o=new Me._;o.confirmButtonText="Yes",o.declineButtonText="No",o.message=t,this.messageDialogService.openConfirmationDialog(o).subscribe(n=>{"Confirmed"===n&&this.dialog.close()})}else this.dialog.close()}finish(){this.dialog.close(this.importedCollectionId)}ngOnDestroy(){this.subscription.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(A.WI),e.Y36(A.so),e.Y36(Y.T),e.Y36(te.Y))},i.\u0275cmp=e.Xpm({type:i,selectors:[["collection-import"]],decls:9,vars:4,consts:[[1,"am-dialog"],[3,"title","description","action"],["body","",1,"dialog-contents"],[1,"ps-show-always"],[1,"wrapper"],[3,"progressModel"],["align","end",1,"mat-dialog-actions","action-buttons"],["mat-raised-button","","color","primary",3,"disabled","click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"form-section",1),e.TgZ(2,"div",2),e.TgZ(3,"perfect-scrollbar",3),e.TgZ(4,"div",4),e._UZ(5,"am-progress-bar",5),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(6,"div",6),e.TgZ(7,"button",7),e.NdJ("click",function(){return o.finish()}),e._uU(8,"Finish"),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(1),e.Q6J("title","Collection Import")("action",o.closeAction),e.xp6(4),e.Q6J("progressModel",o.progressModel),e.xp6(2),e.Q6J("disabled",o.progressModel.state===o.progressState.Started||o.progressModel.state===o.progressState.Unstarted))},directives:[k.A,Q.Vv,Ae.Y,D.lW],styles:[".wrapper[_ngcontent-%COMP%]{padding:2.25rem 1.5rem 1rem}.action-buttons[_ngcontent-%COMP%]{flex:1}"]}),i})();var B=s(35778);class ${}$.tabs=[new B.f("Collections",d.collectionsUrl),new B.f("Configuration",d.configurationUrl)];var f=s(46261),O=s(591),u=s(8929);class ke{constructor(a="",t="",o="",n=!1,l=!1,c=!1,m=!1){this.username=a,this.domainFqdn=o,this.password=t,this.enableUpdates=m,this.includeMsUpdates=n,this.includeOtherUpdates=c,this.includeRecommendedUpdates=l}}class oe{constructor(a,t,o,n,l,c){this.id=a,this.name=t,this.description=o,this.typeId=n,this.typeName=l,this.hasNestedCollections=c}}var b=s(92198),ie=s(22868),H=s(73837),E=s(37777),x=s(61654),ne=s(80045);let T=(()=>{class i{constructor(t,o,n,l){this.dataRepositoryService=t,this.collectionHttpService=o,this.dataUpdateService=n,this.router=l,this.fakeServiceAccountPassword="password",this.isReloadNeeded=!0,this.isConfigurationReloadNeeded=!0,this.collections=new O.X(null),this.configurationLoaded=new O.X(null),this.collectionSelected=new O.X(null),this.collectionInfoUnsaved=new u.xQ,this.adConfigurationUnsaved=new u.xQ,this.dataRepositoryService.currentEnvironmentSubject.pipe((0,b.h)(c=>null!=c)).subscribe(c=>{this.environment=c,this.fetchCollections(),this.fetchGlobalConfiguration()}),this.handleRouteChanges(),this.handleUpdates()}static convertCollectionDetailsToCollectionDto(t){return new oe(t.id,t.name,t.description,t.typeId,t.typeName,t.hasNestedCollections)}handleRouteChanges(){this.router.events.subscribe(t=>{t instanceof v.m2&&(t.url.startsWith(`/${d.collectionsPath}`)||(this.isReloadNeeded=!0,this.isConfigurationReloadNeeded=!0,this.collections.next(null)))})}fetchCollections(t=!1){!this.isFetching&&(this.isReloadNeeded||t)&&(this.isFetching=!0,this.collectionHttpService.getCollections(this.environment.id).subscribe(o=>{this.collections.next(o),this.isReloadNeeded=!1,this.isFetching=!1},()=>{this.collections.next([]),this.isFetching=!1}))}getCollections(){return this.fetchCollections(),this.collections}fetchCollection(t){this.collectionHttpService.getCollection(this.environment.id,t,!0).subscribe(o=>{this.collectionSelected.next(o)},()=>{this.collectionSelected.next(null)})}saveCollectionInfo(t){const o=new u.xQ;return this.collectionHttpService.saveCollectionDetails(this.environment.id,t).subscribe(n=>{C.c.isEmpty(t.id)?this.handleCollectionCreation(n):this.handleCollectionUpdate(n),o.next({succeeded:!0,id:n.id})},()=>{o.next({succeeded:!1,id:null})}),o.asObservable()}deleteCollection(t){return this.collectionHttpService.deleteCollection(this.environment.id,t).pipe((0,ie.b)(()=>this.handleCollectionDeletion(t)))}duplicateCollection(t){return this.collectionHttpService.duplicateCollection(this.environment.id,t).pipe((0,ie.b)(o=>this.handleCollectionDtoCreation(o)))}navigateToCollectionList(){this.router.navigate([d.collectionsUrl])}handleCollectionCreation(t){this.handleCollectionDtoCreation(i.convertCollectionDetailsToCollectionDto(t))}handleCollectionDtoCreation(t){null!=this.collections.value&&null!=t&&this.collections.value.push(t)}handleCollectionUpdate(t){this.handleCollectionDtoUpdate(i.convertCollectionDetailsToCollectionDto(t)),null!=this.collectionSelected&&!C.c.isEmpty(t.id)&&this.collectionSelected.value.id===t.id&&this.collectionSelected.next(t)}handleCollectionDtoUpdate(t){if(null!=this.collections.value){const o=this.collections.value,n=o.findIndex(l=>l.id===t.id);n>=0&&(o[n]=t)}}handleCollectionDeletion(t){if(null!=this.collections.value){const o=this.collections.value,n=o.findIndex(l=>l.id===t);n>=0&&o.splice(n,1)}}handleUpdates(){this.dataUpdateService.receiveCollectionUpdates().subscribe(t=>{if(this.router.url.startsWith(`/${d.collectionsPath}`)&&null!=this.collections.value){const o=t.data;t.updateType===H.t.Created?this.handleCollectionDtoCreation(o):t.updateType===H.t.Modified&&this.handleCollectionDtoUpdate(o)}})}fetchGlobalConfiguration(){!this.isConfigurationFetching&&this.isConfigurationReloadNeeded&&(this.isConfigurationFetching=!0,this.collectionHttpService.getGlobalConfiguration(this.environment.id).subscribe(t=>{this.configurationLoaded.next(t),this.isConfigurationReloadNeeded=!1,this.isConfigurationFetching=!1},()=>{this.isConfigurationFetching=!1}))}saveActiveDirectoryConfiguration(t){const o=new u.xQ;return this.collectionHttpService.saveGlobalCollectionAdConfiguration(this.environment.id,t.serviceAccountFormControl.value,"password"!==t.passwordFormControl.value?t.passwordFormControl.value:"",t.fqdnFormControl.value).subscribe(()=>{this.adConfigurationUnsaved.next(!1),t.setServiceAccountPassword(this.fakeServiceAccountPassword);const n=this.configurationLoaded.value??new ke;n.username=t.serviceAccount,n.password=t.password,n.domainFqdn=t.fqdn,this.configurationLoaded.next(n),o.next(!0)},()=>{o.next(!1)}),o.asObservable()}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(E.Y),e.LFG(x.$),e.LFG(ne._),e.LFG(v.F0))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var G=s(12333),De=s(97987),W=s(9120),le=s(81285),y=s(96308),r=s(30671),p=s(80013),R=s(66216),Z=s(78033),Ue=s(31371),Ie=s(37130),L=s(6184),ae=s(71102),Ne=s(10266),Pe=s(6994),z=s(13217),V=s(27969);function Fe(i,a){1&i&&(e.TgZ(0,"div",4),e._uU(1," There are no collections\n"),e.qZA())}function qe(i,a){1&i&&(e.TgZ(0,"mat-header-cell",21),e._uU(1,"Collection name "),e.qZA())}function Ee(i,a){1&i&&(e.TgZ(0,"span",24),e._uU(1,"!"),e.qZA())}function Le(i,a){if(1&i&&(e.TgZ(0,"mat-cell",22),e._uU(1),e.YNc(2,Ee,2,0,"ng-template",23),e.qZA()),2&i){const t=a.$implicit;e.xp6(1),e.hij(" ",t.name," "),e.xp6(1),e.Q6J("ngIf",t.hasNestedCollections)}}function Qe(i,a){1&i&&(e.TgZ(0,"mat-header-cell",25),e._uU(1,"Description"),e.qZA())}function Je(i,a){if(1&i&&(e.TgZ(0,"mat-cell",26),e._uU(1),e.qZA()),2&i){const t=a.$implicit;e.xp6(1),e.hij(" ",t.description," ")}}function Ye(i,a){1&i&&(e.TgZ(0,"mat-header-cell",27),e._uU(1,"Category"),e.qZA())}function Oe(i,a){if(1&i&&(e.TgZ(0,"mat-cell",28),e._uU(1),e.qZA()),2&i){const t=a.$implicit;e.xp6(1),e.hij("",t.typeName," ")}}function He(i,a){1&i&&e._UZ(0,"mat-header-cell",29)}function Re(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-cell",30),e.TgZ(1,"button",31),e._UZ(2,"am-icon",32),e.qZA(),e.TgZ(3,"mat-menu",33,34),e.TgZ(5,"button",35),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw(2).downloadCollectionClicked.next(l)}),e._uU(6," Download "),e.qZA(),e.TgZ(7,"button",35),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw(2).duplicatedCollectionClicked.next(l)}),e._uU(8," Duplicate "),e.qZA(),e.TgZ(9,"button",35),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw(2).sendToEnvironmentClick(l)}),e._uU(10," Send to "),e.qZA(),e.TgZ(11,"button",35),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw(2).deleteCollectionClicked.next(l)}),e._uU(12," Delete "),e.qZA(),e.qZA(),e.qZA()}if(2&i){const t=e.MAs(4),o=e.oxw(2);e.xp6(1),e.Q6J("matMenuTriggerFor",t),e.xp6(1),e.Q6J("iconClasses",o.icons.fontAwesome.ELLIPSIS_V)("title",""),e.xp6(1),e.Q6J("xPosition","before")}}function Ve(i,a){1&i&&e._UZ(0,"mat-header-row",36)}function je(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-row",37),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw(2).navigateToCollectionDetails(l)}),e.qZA()}}function Be(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-table",5,6),e.NdJ("matSortChange",function(n){return e.CHM(t),e.oxw().sortData(n)}),e.ynx(2,7),e.YNc(3,qe,2,0,"mat-header-cell",8),e.YNc(4,Le,3,2,"mat-cell",9),e.BQk(),e.ynx(5,10),e.YNc(6,Qe,2,0,"mat-header-cell",11),e.YNc(7,Je,2,1,"mat-cell",12),e.BQk(),e.ynx(8,13),e.YNc(9,Ye,2,0,"mat-header-cell",14),e.YNc(10,Oe,2,1,"mat-cell",15),e.BQk(),e.ynx(11,16),e.YNc(12,He,1,0,"mat-header-cell",17),e.YNc(13,Re,13,4,"mat-cell",18),e.BQk(),e.YNc(14,Ve,1,0,"mat-header-row",19),e.YNc(15,je,1,0,"mat-row",20),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("dataSource",t.dataSource),e.xp6(14),e.Q6J("matHeaderRowDef",t.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns)}}let $e=(()=>{class i{constructor(t,o,n,l,c,m,g,U){this.collectionManagerService=t,this.collectionHttpService=o,this.messageDialogService=n,this.fileSaver=l,this.dialog=c,this.messagingService=m,this.dataUpdateService=g,this.router=U,this.onLoadSingleCollection=new e.vpe,this.onGetCollectionList=new e.vpe,this.icons=M.R.icons,this.displayedColumns=["name","description","typeName","actions"],this.dataSource=new r.by([]),this.duplicatedCollectionClicked=new u.xQ,this.downloadCollectionClicked=new u.xQ,this.deleteCollectionClicked=new u.xQ,this.subscription=new w.w,this.onCollectionRowClicked=new u.xQ}ngOnInit(){this.isLoading=!1,R.h.currentEnvironment.subscribe(n=>{this.selectedEnvironment=n,this.fetchCollections();const l=this.onCollectionRowClicked.pipe((0,p.b)(200)).subscribe(c=>{if(c.evt&&c.evt.target){const m=c.evt.target.tagName.toLowerCase().toString();if(["button","am_icon","svg","path"].indexOf(m)>=0)return void c.evt.stopPropagation()}this.onLoadSingleCollection.emit(c.collection.id)});this.subscription.add(l)});const o=this.dataUpdateService.receiveCollectionUpdates().subscribe(n=>{if(n.updateType===H.t.Created)this.dataSource.data.push(n.data);else if(n.updateType===H.t.Modified){const l=this.dataSource.data.findIndex(c=>c.id===n.data.id);-1!==l&&(this.dataSource.data[l]=n.data)}this.dataSource.data=this.dataSource.data,this.sortData(this.sort)});this.subscription.add(o)}addDuplicatedCollection(t,o){const n=new oe(o.id,o.name,o.description,o.typeId,o.typeName,o.hasNestedCollections);this.messagingService.sendInfoMessage(`Collection ${t.name} has been duplicated.`);const l=this.dataSource.data.findIndex(c=>c.id===t.id);this.dataSource.data.splice(l+1,0,n),this.sort.direction="asc",this.sort.active="name",this.sortData(this.sort),this.dataSource.data=this.dataSource.data}ngAfterViewInit(){const o=this.duplicatedCollectionClicked.pipe((0,p.b)(300)).subscribe(c=>{this.collectionManagerService.duplicateCollection(c.id).subscribe(m=>{m&&this.addDuplicatedCollection(c,m)},m=>{this.messagingService.sendErrorMessage(m)})});this.subscription.add(o);const n=this.downloadCollectionClicked.pipe((0,p.b)(300)).subscribe(c=>{this.collectionHttpService.downloadCollection(this.selectedEnvironment.id,c.id).subscribe(m=>{this.fileSaver.save(m,`${c.name}.amcol`)},m=>{console.warn(m),this.messagingService.sendErrorMessage(m)})});this.subscription.add(n);const l=this.deleteCollectionClicked.pipe((0,p.b)(300)).subscribe(c=>{this.messageDialogService.openConfirmationDialog(`Are you sure you want to delete "${c.name}"? You cannot undo this action.`).subscribe(m=>{"Confirmed"===m&&this.collectionManagerService.deleteCollection(c.id).subscribe(g=>{g&&this.deleteCollection(g,c)},g=>{console.warn(g)})})});this.subscription.add(l)}deleteCollection(t,o){this.messagingService.sendInfoMessage(`Collection ${o.name} has been deleted.`);const n=this.dataSource.data.findIndex(l=>l.id===o.id);this.dataSource.data.splice(n,1),this.sort.direction="asc",this.sortData(this.sort),this.dataSource.data=this.dataSource.data}fetchCollections(){this.isLoading=!0,this.collectionManagerService.fetchCollections(),this.collectionManagerService.collections.pipe((0,b.h)(t=>null!=t)).subscribe(t=>{this.dataSource.data=t,this.sortData(new class{constructor(){this.active="name",this.direction="asc"}}),this.onGetCollectionList.emit(t),this.isLoading=!1},()=>{this.isLoading=!1})}ngOnDestroy(){this.dataSource.data=[],this.subscription.unsubscribe()}sortData(t){const o=[...this.dataSource.data.slice()];if(!t.active||""===t.direction)return void(this.dataSource.data=o);const n="asc"===t.direction;this.dataSource.data=o.sort((l,c)=>{switch(t.active){case"name":return(0,Z.qu)(l.name,c.name,n);case"description":return(0,Z.qu)(l.description??"",c.description??"",n);case"typeName":return(0,Z.qu)(l.typeName??"",c.typeName??"",n);default:return 0}})}sendToEnvironmentClick(t){this.dialog.open(Ue.u,{data:t,panelClass:"am-dialog-container",height:"451px"})}navigateToCollectionDetails(t){this.router.navigate([d.getCollectionUrl(t.id)])}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(T),e.Y36(x.$),e.Y36(Y.T),e.Y36(Ie.m9),e.Y36(A.uw),e.Y36(L.w),e.Y36(ne._),e.Y36(v.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["collections-list"]],viewQuery:function(t,o){if(1&t&&e.Gf(y.YE,5),2&t){let n;e.iGM(n=e.CRH())&&(o.sort=n.first)}},outputs:{onLoadSingleCollection:"onLoadSingleCollection",onGetCollectionList:"onGetCollectionList"},decls:5,vars:4,consts:[["class","pt-4 pl-2 mb-0",4,"ngIf"],[3,"loading","loadingText"],["class","dashboard-table","matSort","","matSortActive","name","matSortDirection","asc",3,"dataSource","matSortChange",4,"ngIf"],[1,"pre-footer","mb-1","mt-0","pt-1","pb-0","pl-2","pr-2"],[1,"pt-4","pl-2","mb-0"],["matSort","","matSortActive","name","matSortDirection","asc",1,"dashboard-table",3,"dataSource","matSortChange"],["table",""],["matColumnDef","name"],["mat-sort-header","","class","text-left pl-3 collection-name",4,"matHeaderCellDef"],["class","text-left pl-3 collection-name",4,"matCellDef"],["matColumnDef","description"],["mat-sort-header","","class","text-left collection-description",4,"matHeaderCellDef"],["class","text-left collection-description",4,"matCellDef"],["matColumnDef","typeName"],["mat-sort-header","","class","text-left collection-category",4,"matHeaderCellDef"],["class","text-left collection-category",4,"matCellDef"],["matColumnDef","actions"],["class","text-left collection-actions",4,"matHeaderCellDef"],["class","justify-content-end pr-0 collection-actions",4,"matCellDef"],["class","pl-0 pr-0",4,"matHeaderRowDef"],["class","pl-0 pointer",3,"click",4,"matRowDef","matRowDefColumns"],["mat-sort-header","",1,"text-left","pl-3","collection-name"],[1,"text-left","pl-3","collection-name"],[3,"ngIf"],["matTooltip","This collection contains more collections, this is unsupported using the web interface.",1,"text-error","ml-1","mr-1"],["mat-sort-header","",1,"text-left","collection-description"],[1,"text-left","collection-description"],["mat-sort-header","",1,"text-left","collection-category"],[1,"text-left","collection-category"],[1,"text-left","collection-actions"],[1,"justify-content-end","pr-0","collection-actions"],["stopPropagation","","mat-icon-button","",3,"matMenuTriggerFor"],[3,"iconClasses","title"],[3,"xPosition"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"pl-0","pr-0"],[1,"pl-0","pointer",3,"click"]],template:function(t,o){1&t&&(e.YNc(0,Fe,2,0,"div",0),e.TgZ(1,"loading-container",1),e.YNc(2,Be,16,3,"mat-table",2),e.TgZ(3,"p",3),e._uU(4,"\xa0 "),e.qZA(),e.qZA()),2&t&&(e.Q6J("ngIf",!(o.dataSource.data&&0!=o.dataSource.data.length||o.isLoading)),e.xp6(1),e.Q6J("loading",o.isLoading)("loadingText","Loading collections..."),e.xp6(1),e.Q6J("ngIf",o.dataSource.data&&o.dataSource.data.length>0))},directives:[S.O5,ae.o,r.BZ,y.YE,r.w1,r.fO,r.ge,y.nU,r.Dz,r.ev,Ne.gM,D.lW,Pe._,z.p6,V.b,z.VK,z.OP,r.as,r.XQ,r.nj,r.Gk],styles:[".pre-footer[_ngcontent-%COMP%]{background-color:#e4e4e4;box-shadow:0 2px 2px #61616180}"]}),i})();var Ge=s(42254);let We=(()=>{class i{constructor(t,o,n,l,c,m,g,U,K){this.collectionManagerService=t,this.tristateService=o,this.dialog=n,this.importService=l,this.collectionsManagerHttpService=c,this.fileUploadService=m,this.dataRepositoryService=g,this.router=U,this.hotkeysService=K,this.subscription=new w.w,this.icons=M.R.icons,this.collectionActions=[],this.collectionCount=0,this.importCollectionComponentId="import-collection-file-upload",this.isEditMode=!1,this.tabs=$.tabs}ngOnInit(){this.hotkeysService.add(new f.qm("alt+n",()=>(d.collectionsUrl===this.router.url&&this.createNewCollection(),!1),[],"Add a collection")),this.hotkeysService.add(new f.qm("alt+m",()=>(d.collectionsUrl===this.router.url&&this.importCollection(),!1),[],"Import collection")),this.setupActions(),this.subscription.add(this.dataRepositoryService.currentEnvironmentSubject.subscribe(t=>{this.selectedEnvironment=t,this.selectedEnvironmentName=t?t.name:"Environment is not selected"}))}createNewCollection(){this.router.navigate([d.getCollectionInfoUrl(C.c.Empty)])}setupActions(){this.collectionAction=new q.r,this.collectionAction.description="Add a collection",this.collectionAction.title="Add a collection",this.collectionAction.tooltipTitle="Create a new collection",this.collectionAction.icon=this.icons.fontAwesome.PLUS,this.collectionAction.action=this.createNewCollection.bind(this),this.collectionActions.push(this.collectionAction);const t=new q.r;t.title="Import collection",t.tooltipTitle="Import collection from file",t.action=this.importCollection.bind(this),this.collectionActions.push(t)}get tableDescription(){return this.collectionCount<=0?"":1===this.collectionCount?` ${this.collectionCount} collection `:` ${this.collectionCount} collections `}importCollection(){this.fileUploadService.requestUpload(this.importCollectionComponentId)}onImportCollectionFileSelected(t){if(null!=t&&t.length>0){const o=C.c.newGuid();this.importService.importEntity(this.selectedEnvironment.id,o,t,xe.q.Collection),this.dialog.open(ye,{panelClass:"am-dialog-container",height:"274px",data:o}).afterClosed().subscribe(l=>{})}}ngOnDestroy(){this.subscription.unsubscribe(),this.hotkeysService.remove(this.hotkeysService.hotkeys.filter(t=>"alt+n"===t.combo[0]||"alt+m"===t.combo[0]))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(T),e.Y36(G.S),e.Y36(A.uw),e.Y36(te.Y),e.Y36(x.$),e.Y36(De.V),e.Y36(E.Y),e.Y36(v.F0),e.Y36(f.tm))},i.\u0275cmp=e.Xpm({type:i,selectors:[["collection-manager"]],decls:7,vars:9,consts:[["body",""],[1,"container"],[1,"col-lg-11","offset-lg-1"],[3,"tabs"],[3,"action","actionMode","actions","title","description"],[3,"requestId","allowedExtensions","multiple","filesSelected"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"am-page-tabs",3),e._UZ(4,"table-header",4),e._UZ(5,"collections-list"),e.TgZ(6,"am-immediate-file-upload",5),e.NdJ("filesSelected",function(l){return o.onImportCollectionFileSelected(l)}),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(3),e.Q6J("tabs",o.tabs),e.xp6(1),e.Q6J("action",o.collectionAction)("actionMode","drop-down-button")("actions",o.collectionActions)("title","COLLECTIONS ")("description",o.tableDescription),e.xp6(2),e.Q6J("requestId",o.importCollectionComponentId)("allowedExtensions",".amcol")("multiple",!1))},directives:[W.a,le.a,$e,Ge.w],styles:[".mat-tab-label{text-transform:uppercase}\n"],encapsulation:2}),i})();var ze=s(4610);class Xe{constructor(){this.id="",this.name="",this.description="",this.typeId="",this.typeName="",this.hasNestedCollections=!1,this.computers=[],this.packageList=new ze.X,this.hasLayers=!1}}class se{constructor(){this.name="",this.typeName="",this.typeId="",this.nameFormControl=new h.NI(this.name,[],[]),this.description="",this.descriptionFormControl=new h.NI(this.description,h.kI.compose([])),this.typeFormControl=new h.NI(this.typeId)}resetDirty(){this.nameFormControl.reset(this.name),this.descriptionFormControl.reset(this.description),this.typeFormControl.reset(this.typeId)}get isValid(){return this.nameFormControl.valid&&this.typeFormControl.valid&&this.descriptionFormControl.valid}get isDirty(){return this.nameFormControl.dirty||this.descriptionFormControl.dirty||this.typeFormControl.dirty}}class ce{}let re=(()=>{class i{constructor(t,o){this.collectionManagerHttpService=t,this._collectionTypes=new O.X(null),o.currentEnvironmentSubject.subscribe(n=>{null==n?this._collectionTypes.next(null):this.getCollectionTypes(n.id).subscribe(l=>{this._collectionTypes.next(l)})})}get collectionTypes(){return this._collectionTypes}getCollectionTypes(t){return this.collectionManagerHttpService.getCollectionTypes(t)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(x.$),e.LFG(E.Y))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var _=s(59549),N=s(44144),Ke=s(84385),et=s(3238);const tt=["collectionName"];function ot(i,a){1&i&&(e.TgZ(0,"mat-header-cell",28),e._uU(1,"Name"),e.qZA())}function it(i,a){1&i&&e._UZ(0,"mat-cell")}function nt(i,a){1&i&&(e.TgZ(0,"mat-header-cell",29),e._uU(1,"Description"),e.qZA())}function lt(i,a){1&i&&e._UZ(0,"mat-cell")}function at(i,a){1&i&&(e.TgZ(0,"mat-header-cell",30),e._uU(1,"Type"),e.qZA())}function st(i,a){1&i&&e._UZ(0,"mat-cell")}function ct(i,a){1&i&&e._UZ(0,"mat-header-row",31)}function rt(i,a){1&i&&e._UZ(0,"mat-row",31)}function dt(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Collection name already taken "),e.qZA())}function mt(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Name is required "),e.qZA())}function ut(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Name contains invalid symbols "),e.qZA())}function ht(i,a){if(1&i&&(e.TgZ(0,"mat-option",32),e._uU(1),e.qZA()),2&i){const t=a.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}const pt=function(){return[]},de=function(){return["name","description","type"]};let me=(()=>{class i{constructor(t,o,n,l){this.collectionsHttpService=t,this.collectionManagerService=o,this.collectionTypeService=n,this.router=l,this.modelChanged=new e.vpe,this.isEditMode=!1,this.subscription=new w.w,this.goldenImageTypeId="c040122b-8667-45ba-ab24-880c8f1d91c1",this.viewModel=new se,this.viewModelClone=new se}checkIfNewCollection(){C.c.isEmpty(this.viewModel.id)&&(this.isEditMode=!0,setTimeout(()=>{this.nameField.nativeElement.focus()},50))}checkIfNameIsValid(){this.collections.find(t=>t.name===this.viewModel.nameFormControl.value)&&this.viewModel.nameFormControl.value!==this.viewModelClone.name?this.viewModel.nameFormControl.setErrors({unique:!0}):this.viewModel.nameFormControl.setErrors(null)}ngOnInit(){this.subscription.add(this.collectionTypeService.collectionTypes.pipe((0,b.h)(t=>null!=t)).subscribe(t=>{this.collectionTypes=t.filter(o=>o.id!==this.goldenImageTypeId)})),this.subscription.add(this.collectionManagerService.getCollections().subscribe(t=>{this.collections=t})),this.subscription.add(this.collectionManagerService.collectionSelected.pipe((0,b.h)(t=>null!=t)).subscribe(t=>{this.bindToModel(t),this.cloneModel(),this.resolveUrl(),this.checkIfNewCollection()})),R.h.currentEnvironment.subscribe(t=>{this.selectedEnvironment=t}),this.viewModel.typeOptions=this.collectionTypes}resolveUrl(){this.router.url===d.getCollectionInfoUrl(this.viewModelClone.id)&&(this.isEditMode=!0)}cloneModel(){this.viewModelClone.id=this.viewModel.id,this.viewModelClone.name=this.viewModel.name,this.viewModelClone.description=this.viewModel.description,this.viewModelClone.typeId=this.viewModel.typeId,this.viewModelClone.typeName=this.viewModel.typeName,this.viewModelClone.typeFormControl.setValue(this.viewModel.typeFormControl.value)}get isModelEdited(){return!(this.viewModel.nameFormControl.value===this.viewModelClone.name&&this.viewModel.descriptionFormControl.value===this.viewModelClone.description&&this.viewModel.typeId===this.viewModelClone.typeId)}get allowSave(){return""!==this.viewModel.nameFormControl.value&&this.isModelEdited&&""!==this.viewModel.typeId&&this.viewModel.nameFormControl.valid}bindToModel(t){this.viewModel.id=t.id,this.viewModel.name=t.name,this.viewModel.nameFormControl.setValue(t.name),this.viewModel.description=t.description,this.viewModel.descriptionFormControl.setValue(t.description),this.viewModel.typeName=t.typeName,this.viewModel.typeFormControl.setValue(t.typeName),this.viewModel.typeId=t.typeId,this.viewModel.typeFormControl.setValue(t.typeId),this.subscription.add(this.viewModel.nameFormControl.valueChanges.subscribe(()=>this.onInputChange())),this.subscription.add(this.viewModel.descriptionFormControl.valueChanges.subscribe(()=>this.onInputChange())),this.subscription.add(this.viewModel.typeFormControl.valueChanges.subscribe(()=>this.onInputChange()))}onTypeChanged(t){this.viewModel.typeId=t.value;const o=this.viewModel.typeOptions.findIndex(n=>n.id===t.value);this.viewModel.typeName=this.viewModel.typeOptions[o].name,this.viewModel.typeId=this.viewModel.typeOptions[o].id}saveChanges(){const t=new ce;t.id=this.viewModel.id,t.name=this.viewModel.nameFormControl.value,t.description=this.viewModel.descriptionFormControl.value,t.typeId=this.viewModel.typeFormControl.value,this.collectionManagerService.saveCollectionInfo(t).subscribe(o=>{o.succeeded&&(this.collectionManagerService.collectionInfoUnsaved.next(!1),this.router.navigate([d.getCollectionUrl(o.id)]))})}cancelChanges(){this.collectionManagerService.collectionInfoUnsaved.next(!1);const t=C.c.isEmpty(this.viewModelClone.id)?d.collectionsUrl:d.getCollectionUrl(this.viewModelClone.id);this.router.navigate([t])}onInputChange(){this.collectionManagerService.collectionInfoUnsaved.next(this.viewModel.nameFormControl.value!==this.viewModelClone.nameFormControl.value||this.viewModel.descriptionFormControl.value!==this.viewModelClone.descriptionFormControl.value||this.viewModel.typeFormControl.value!==this.viewModelClone.typeFormControl.value);const o=new ce;o.id=this.viewModel.id,o.name=this.viewModel.nameFormControl.value,o.description=this.viewModel.descriptionFormControl.value,o.typeId=this.viewModel.typeFormControl.value,this.checkIfNameIsValid(),this.modelChanged.emit(this.allowSave?o:null)}navigateToCollectionInfo(){this.router.navigate([d.getCollectionInfoUrl(this.viewModelClone.id)])}ngOnDestroy(){this.subscription.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(x.$),e.Y36(T),e.Y36(re),e.Y36(v.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["collection-details"]],viewQuery:function(t,o){if(1&t&&e.Gf(tt,5),2&t){let n;e.iGM(n=e.CRH())&&(o.nameField=n.first)}},outputs:{modelChanged:"modelChanged"},decls:40,vars:24,consts:[[3,"isEditMode","counter","isSubmitEnabled","title","description","onCancel","onSave"],["body",""],[3,"dataSource"],["matColumnDef","name"],["class","pl-3 name-header",4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","description"],["class","pl-3 description-header",4,"matHeaderCellDef"],["matColumnDef","type"],["class","pl-3 type-header",4,"matHeaderCellDef"],["class","pl-0",4,"matHeaderRowDef"],["class","pl-0",4,"matRowDef","matRowDefColumns"],["readonly-view",""],[1,"container"],[1,"row","mt-0","pointer","read-only",3,"click"],[1,"col","pt-3","pb-3"],[1,"col","pt-3","pb-3","border-left"],["edit-view",""],[1,"row","mt-0","pointer"],[1,"col","pt-0","pb-0"],[1,"full-width",3,"floatLabel"],["name","name","matInput","","placeholder","Name",3,"formControl","keyup"],["collectionName",""],[4,"ngIf"],[1,"col","pt-0","pb-0","border-left"],["matInput","","name","Description","placeholder","Description",3,"formControl"],["placeholder","Category",3,"formControl","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"pl-3","name-header"],[1,"pl-3","description-header"],[1,"pl-3","type-header"],[1,"pl-0"],[3,"value"]],template:function(t,o){1&t&&(e.TgZ(0,"form-section",0),e.NdJ("onCancel",function(){return o.cancelChanges()})("onSave",function(){return o.saveChanges()}),e.TgZ(1,"div",1),e.TgZ(2,"mat-table",2),e.ynx(3,3),e.YNc(4,ot,2,0,"mat-header-cell",4),e.YNc(5,it,1,0,"mat-cell",5),e.BQk(),e.ynx(6,6),e.YNc(7,nt,2,0,"mat-header-cell",7),e.YNc(8,lt,1,0,"mat-cell",5),e.BQk(),e.ynx(9,8),e.YNc(10,at,2,0,"mat-header-cell",9),e.YNc(11,st,1,0,"mat-cell",5),e.BQk(),e.YNc(12,ct,1,0,"mat-header-row",10),e.YNc(13,rt,1,0,"mat-row",11),e.qZA(),e.qZA(),e.TgZ(14,"div",12),e.TgZ(15,"div",13),e.TgZ(16,"div",14),e.NdJ("click",function(){return o.navigateToCollectionInfo()}),e.TgZ(17,"div",15),e._uU(18),e.qZA(),e.TgZ(19,"div",16),e._uU(20),e.qZA(),e.TgZ(21,"div",16),e._uU(22),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(23,"div",17),e.TgZ(24,"div",13),e.TgZ(25,"div",18),e.TgZ(26,"div",19),e.TgZ(27,"mat-form-field",20),e.TgZ(28,"input",21,22),e.NdJ("keyup",function(){return o.checkIfNameIsValid()}),e.qZA(),e.YNc(30,dt,2,0,"mat-error",23),e.YNc(31,mt,2,0,"mat-error",23),e.YNc(32,ut,2,0,"mat-error",23),e.qZA(),e.qZA(),e.TgZ(33,"div",24),e.TgZ(34,"mat-form-field",20),e._UZ(35,"input",25),e.qZA(),e.qZA(),e.TgZ(36,"div",24),e.TgZ(37,"mat-form-field",20),e.TgZ(38,"mat-select",26),e.NdJ("selectionChange",function(l){return o.onTypeChanged(l)}),e.YNc(39,ht,2,2,"mat-option",27),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.Q6J("isEditMode",o.isEditMode)("counter",1)("isSubmitEnabled",o.allowSave)("title","INFO")("description","New Collection"),e.xp6(2),e.Q6J("dataSource",e.DdM(21,pt)),e.xp6(10),e.Q6J("matHeaderRowDef",e.DdM(22,de)),e.xp6(1),e.Q6J("matRowDefColumns",e.DdM(23,de)),e.xp6(5),e.hij(" ",o.viewModel.nameFormControl.value," "),e.xp6(2),e.hij(" ",o.viewModel.descriptionFormControl.value," "),e.xp6(2),e.hij(" ",o.viewModel.typeName," "),e.xp6(5),e.Q6J("floatLabel","never"),e.xp6(1),e.Q6J("formControl",o.viewModel.nameFormControl),e.xp6(2),e.Q6J("ngIf",o.viewModel.nameFormControl.hasError("unique")),e.xp6(1),e.Q6J("ngIf",o.viewModel.nameFormControl.hasError("required")),e.xp6(1),e.Q6J("ngIf",o.viewModel.nameFormControl.hasError("invalidCharacters")),e.xp6(2),e.Q6J("floatLabel","never"),e.xp6(1),e.Q6J("formControl",o.viewModel.descriptionFormControl),e.xp6(2),e.Q6J("floatLabel","never"),e.xp6(1),e.Q6J("formControl",o.viewModel.typeFormControl),e.xp6(1),e.Q6J("ngForOf",o.viewModel.typeOptions))},directives:[k.A,r.BZ,r.w1,r.fO,r.ge,r.Dz,r.ev,r.as,r.XQ,r.nj,r.Gk,_.KE,N.Nt,h.Fj,h.JJ,h.oH,S.O5,_.TO,Ke.gD,S.sg,et.ey],styles:[".name-header[_ngcontent-%COMP%]{max-width:33.25%;min-width:33.25%}.description-header[_ngcontent-%COMP%]{max-width:33.4%;min-width:33.4%}.type-header[_ngcontent-%COMP%]{max-width:33%;min-width:33%}.read-only[_ngcontent-%COMP%]{min-height:56px}.container[_ngcontent-%COMP%]{background:#FFFFFF}.border-left[_ngcontent-%COMP%]{border-left:1px solid #E4E4E4}"]}),i})();class gt{constructor(a){this.id=C.c.newGuid(),this.name=a}}var P=s(75778),F=s(53951);let ue=(()=>{class i{constructor(t,o,n){this.dialogRef=t,this.data=o,this.hotkeysService=n,this.dialogTitle="Add a computer",this.dialogDescription="Add a new computer to the collection",this.computerName="",this.computerName=o,""!==o&&(this.dialogDescription="Enter a new name for the computer",this.dialogTitle="Edit computer")}ngOnInit(){this.hotkeysService.pause(this.hotkeysService.hotkeys.filter(t=>"?"!==t.combo[0])),this.hotkeysService.add(new f.qm("enter",()=>(this.onSaveClick(),!1),F.C.hotkeysAllowIn))}onSaveClick(){this.dialogRef.close(this.computerName)}ngOnDestroy(){this.hotkeysService.remove(this.hotkeysService.hotkeys.filter(t=>"enter"===t.combo[0])),this.hotkeysService.unpause(this.hotkeysService.pausedHotkeys.filter(t=>null!=t.combo[0]))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(A.so),e.Y36(A.WI),e.Y36(f.tm))},i.\u0275cmp=e.Xpm({type:i,selectors:[["add-computer-dialog"]],decls:8,vars:3,consts:[[3,"title","description"],["body","",1,"dialog-contents-wrapper"],[1,"dialog-contents"],[1,"computer-name-input"],["matInput","","placeholder","Computer name",3,"ngModel","ngModelChange"],["align","end",1,"mat-dialog-actions","action-buttons"],["mat-raised-button","","color","primary","tabindex","0",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"form-section",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e.TgZ(3,"mat-form-field",3),e.TgZ(4,"input",4),e.NdJ("ngModelChange",function(l){return o.computerName=l}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(5,"div",5),e.TgZ(6,"button",6),e.NdJ("click",function(){return o.onSaveClick()}),e._uU(7,"Save"),e.qZA(),e.qZA()),2&t&&(e.Q6J("title",o.dialogTitle)("description",o.dialogDescription),e.xp6(4),e.Q6J("ngModel",o.computerName))},directives:[k.A,_.KE,N.Nt,h.Fj,h.JJ,h.On,D.lW],styles:["h2[_ngcontent-%COMP%]{font-size:15px;font-weight:500}h2[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{color:#616161;font-weight:300;text-transform:none}.mat-dialog-actions[_ngcontent-%COMP%]{background-color:#eee}.field-icon[_ngcontent-%COMP%]{font-size:15px}.action-buttons[_ngcontent-%COMP%]{padding-right:12px;flex:1}.transfer-media-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:6px}.dialog-contents[_ngcontent-%COMP%]{height:66px;max-height:269px;overflow-y:auto;margin-top:20px;margin-left:20px;margin-right:20px}.dialog-contents-wrapper[_ngcontent-%COMP%]{overflow:auto;background-color:#fff}.computer-name-input[_ngcontent-%COMP%]{width:100%}"]}),i})();const Ct=["computerList"];function ft(i,a){1&i&&(e.TgZ(0,"mat-header-cell",15),e._uU(1," Computer name "),e.qZA())}function _t(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-cell"),e.TgZ(1,"div",16),e.TgZ(2,"div",17),e._uU(3),e.qZA(),e.TgZ(4,"button",18),e.NdJ("click",function(n){const c=e.CHM(t).$implicit;return e.oxw().deleteCollection(c,n)}),e.TgZ(5,"div",19),e._UZ(6,"am-icon",20),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&i){const t=a.$implicit,o=e.oxw();e.xp6(3),e.Oqu(t.name),e.xp6(3),e.Q6J("iconClasses",o.icons.TRASH)}}function vt(i,a){1&i&&e._UZ(0,"mat-header-row",21)}function bt(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-row",22),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw().editComputer(l)}),e.qZA()}if(2&i){const t=a.index;e.ekj("matched",!1),e.Q6J("ngClass","matched-"+t)}}let he=(()=>{class i{constructor(t,o,n,l,c){this.collectionMediator=t,this.dialog=o,this.messagingService=n,this.messageDialogService=l,this.collectionsManagerHttpService=c,this.icons=M.R.icons.fontAwesome,this.displayedColumns=["name"],this.dataSource=new r.by([]),this.editMode=!1,this.subscription=new w.w,this.onFilterChange=new u.xQ}ngOnInit(){this.computerAddAction=new q.r,this.computerAddAction.description="Add a new computer",this.computerAddAction.tooltipTitle="Add a new computer",this.computerAddAction.icon=this.icons.PLUS,this.computerAddAction.action=this.addComputer.bind(this),R.h.currentEnvironment.subscribe(n=>{this.selectedEnvironment=n});const o=this.collectionMediator.collectionSelected.pipe((0,b.h)(n=>null!=n)).subscribe(n=>{this.dataSource.data=n.computers,this.collectionId=n.id});this.subscription.add(o),this.onFilterChangeSubscription=this.onFilterChange.pipe((0,p.b)(400)).pipe((0,P.x)()).subscribe(n=>{this.applyFilter(n)})}ngOnDestroy(){this.subscription.unsubscribe()}addComputer(){""!==this.collectionId?this.dialog.open(ue,{data:"",panelClass:"am-dialog-container"}).afterClosed().subscribe(o=>{if(o&&""!==o){const n=new gt(o);this.dataSource.data.push(n),this.collectionsManagerHttpService.saveComputer(this.collectionId,this.selectedEnvironment.id,n).subscribe(l=>{}),this.dataSource.data=this.dataSource.data}}):this.messagingService.sendInfoMessage("Please save collection first")}editComputer(t){this.dialog.open(ue,{data:t.name,panelClass:"am-dialog-container"}).afterClosed().subscribe(n=>{if(n&&""!==n){const l=this.dataSource.data.findIndex(c=>c.id===t.id);this.dataSource.data[l].name=n,this.collectionsManagerHttpService.saveComputer(this.collectionId,this.selectedEnvironment.id,this.dataSource.data[l]).subscribe(c=>{}),this.dataSource.data=this.dataSource.data}})}applyFilter(t){t&&(t=t.trim().toLowerCase()),this.dataSource.filter=t}deleteCollection(t,o){o.stopPropagation(),this.messageDialogService.openConfirmationDialog(`Do you want to delete "${t.name}" computer?`).pipe((0,p.b)(300)).pipe((0,P.x)()).subscribe(n=>{if("Confirmed"===n){this.collectionsManagerHttpService.deleteCollectionComputer(this.selectedEnvironment.id,t.id).subscribe(()=>{});const l=this.dataSource.data.findIndex(c=>c.id===t.id);this.dataSource.data.splice(l,1),this.table.renderRows()}})}sortData(t){const o=[...this.dataSource.data.slice()];if(!t.active||""===t.direction)return void(this.dataSource.data=o);const n="asc"===t.direction;this.dataSource.data=o.sort((l,c)=>"name"===t.active?(0,Z.qu)(l.name,c.name,n):0)}get Description(){return`${this.dataSource.data.length} computer${1!==this.dataSource.data.length?"s":""}`}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(T),e.Y36(A.uw),e.Y36(L.w),e.Y36(Y.T),e.Y36(x.$))},i.\u0275cmp=e.Xpm({type:i,selectors:[["collection-computer-list"]],viewQuery:function(t,o){if(1&t&&e.Gf(Ct,5),2&t){let n;e.iGM(n=e.CRH())&&(o.table=n.first)}},decls:15,vars:8,consts:[[3,"action","counter","title","description"],["pre-actions","",1,"pull-right","pt-2"],[1,"full-width","search-field"],["matPrefix","",1,"mr-3"],[1,"far","fa-search"],["matInput","","placeholder","Enter your search term...",3,"keyup"],["readonly-view",""],[1,"ps-show-always"],["matSort","","matSortActive","orderNumber","matSortDirection","asc","matSortDisableClear","",3,"dataSource","matSortChange"],["computerList",""],["matColumnDef","name"],["class","computer-name-header","mat-sort-header","",4,"matHeaderCellDef"],[4,"matCellDef"],["class","pl-0",4,"matHeaderRowDef","matHeaderRowDefSticky"],["class","pl-0 pr-0 pointer",3,"ngClass","matched","click",4,"matRowDef","matRowDefColumns"],["mat-sort-header","",1,"computer-name-header"],[1,"computer-name"],[1,"highlight"],["mat-button","",1,"delete-button",3,"click"],[1,"icon-wrapper"],["title","Delete computer",3,"iconClasses"],[1,"pl-0"],[1,"pl-0","pr-0","pointer",3,"ngClass","click"]],template:function(t,o){1&t&&(e.TgZ(0,"form-section",0),e.TgZ(1,"div",1),e.TgZ(2,"mat-form-field",2),e.TgZ(3,"span",3),e._UZ(4,"i",4),e.qZA(),e.TgZ(5,"input",5),e.NdJ("keyup",function(l){return o.onFilterChange.next(l.target.value)}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(6,"div",6),e.TgZ(7,"perfect-scrollbar",7),e.TgZ(8,"mat-table",8,9),e.NdJ("matSortChange",function(l){return o.sortData(l)}),e.ynx(10,10),e.YNc(11,ft,2,0,"mat-header-cell",11),e.YNc(12,_t,7,2,"mat-cell",12),e.BQk(),e.YNc(13,vt,1,0,"mat-header-row",13),e.YNc(14,bt,1,3,"mat-row",14),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.Q6J("action",o.computerAddAction)("counter",2)("title","COMPUTER LIST")("description",o.Description),e.xp6(8),e.Q6J("dataSource",o.dataSource),e.xp6(5),e.Q6J("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumns))},directives:[k.A,_.KE,_.qo,N.Nt,Q.Vv,r.BZ,y.YE,r.w1,r.fO,r.ge,y.nU,r.Dz,r.ev,D.lW,V.b,r.as,r.XQ,r.nj,r.Gk,S.mk],styles:[".computer-name-header[_ngcontent-%COMP%], .computer-name[_ngcontent-%COMP%]{max-width:100%;width:100%}.highlight[_ngcontent-%COMP%]{float:left;padding-top:8px}.icon-wrapper[_ngcontent-%COMP%]{position:relative;right:1px}.container[_ngcontent-%COMP%]{background:#EEEEEE;box-shadow:0 2px 2px #61616180}.delete-button[_ngcontent-%COMP%]{width:40px;float:right}.mat-form-field[_ngcontent-%COMP%]{font-size:12px}.search-field[_ngcontent-%COMP%]{width:235.97px}"]}),i})();var St=s(21324),X=s(87341),wt=s(90414),Tt=s(9893),j=s.n(Tt),xt=s(66591),Zt=s(29531),Mt=s(33615),At=s(39261);function yt(i,a){1&i&&(e.TgZ(0,"mat-header-cell",26),e._uU(1,"Order "),e.qZA())}function kt(i,a){if(1&i&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.orderNumber," ")}}function Dt(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Negative "),e.qZA())}function Ut(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Not number "),e.qZA())}function It(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Required "),e.qZA())}function Nt(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Taken "),e.qZA())}function Pt(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"mat-form-field",2),e.TgZ(2,"input",28),e.NdJ("keyup",function(n){e.CHM(t);const l=e.oxw(),c=l.$implicit,m=l.index;return e.oxw().onOrderChanged.next({term:n.target.value,pckg:c,idx:m})}),e.qZA(),e.YNc(3,Dt,2,0,"mat-error",25),e.YNc(4,Ut,2,0,"mat-error",25),e.YNc(5,It,2,0,"mat-error",25),e.YNc(6,Nt,2,0,"mat-error",25),e.qZA(),e.qZA()}if(2&i){const t=e.oxw().$implicit;e.xp6(2),e.Q6J("formControl",t.formControl),e.xp6(1),e.Q6J("ngIf",t.formControl.hasError("negative")),e.xp6(1),e.Q6J("ngIf",t.formControl.hasError("number")),e.xp6(1),e.Q6J("ngIf",t.formControl.hasError("required")),e.xp6(1),e.Q6J("ngIf",t.formControl.hasError("alreadyTaken"))}}function Ft(i,a){if(1&i&&(e.TgZ(0,"mat-cell",27),e.YNc(1,kt,2,1,"div",25),e.YNc(2,Pt,7,5,"div",25),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.editMode),e.xp6(1),e.Q6J("ngIf",t.editMode)}}function qt(i,a){1&i&&(e.TgZ(0,"mat-header-cell",29),e._uU(1," Application name "),e.qZA())}function Et(i,a){if(1&i&&(e.TgZ(0,"mat-cell",30),e._UZ(1,"div",31),e.ALo(2,"searchhighlight"),e.qZA()),2&i){const t=a.$implicit,o=a.index,n=e.oxw();e.xp6(1),e.Q6J("innerHtml",e.gM2(2,1,t,n.searchTerm,"applicationName",o),e.oJD)}}function Lt(i,a){1&i&&(e.TgZ(0,"mat-header-cell",32),e._uU(1," Description "),e.qZA())}function Qt(i,a){if(1&i&&(e.TgZ(0,"mat-cell",30),e._UZ(1,"div",31),e.ALo(2,"searchhighlight"),e.qZA()),2&i){const t=a.$implicit,o=a.index,n=e.oxw();e.xp6(1),e.Q6J("innerHtml",e.gM2(2,1,t,n.searchTerm,"description",o),e.oJD)}}function Jt(i,a){1&i&&e._UZ(0,"mat-header-cell",33)}function Yt(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"button",36),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit;return e.oxw().onDelete.next(n)}),e._UZ(1,"am-icon",37),e.qZA()}if(2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("iconClasses",t.icons.TRASH)}}function Ot(i,a){if(1&i&&(e.TgZ(0,"mat-cell",34),e.YNc(1,Yt,2,1,"button",35),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.editMode)}}function Ht(i,a){1&i&&e._UZ(0,"mat-header-row",38)}function Rt(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"mat-row",39),e.NdJ("click",function(n){return e.CHM(t),e.oxw().rowClick(n)}),e.qZA()}if(2&i){const t=a.index,o=e.oxw();e.ekj("matched",t==o.currentMatchIndex),e.Q6J("ngClass","matched-"+t)}}function Vt(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"div",40),e.TgZ(2,"div",41),e.TgZ(3,"div",42),e.TgZ(4,"div",43),e.TgZ(5,"button",44),e.NdJ("click",function(n){return e.CHM(t),e.oxw().onCancelClick.next(n)}),e._uU(6," CANCEL "),e.qZA(),e.TgZ(7,"button",45),e.NdJ("click",function(n){return e.CHM(t),e.oxw().onSaveClick.next(n)}),e._uU(8," SAVE "),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(7),e.Q6J("disabled",!t.canSave)}}const pe=s(49870);let ge=(()=>{class i{constructor(t,o,n,l,c,m,g){this.dialogController=t,this.imageManagementHttpService=o,this.messageDialogService=n,this.imageSubject=l,this.collectionMediator=c,this.notificationService=m,this.router=g,this.icons=M.R.icons.fontAwesome,this.packagesList=[],this.onSearch=new u.xQ,this.isLoading=!1,this.collectionId=C.c.Empty,this.displayedColumns=["orderNumber","applicationName","description","action"],this.dataSource=new r.by([]),this.onDelete=new u.xQ,this.onCancelClick=new u.xQ,this.onSaveClick=new u.xQ,this.onOrderChanged=new u.xQ,this.finishedWithPackages=new u.xQ,this.packagesCopy=[],this.nextMatch=new u.xQ,this.prevMatch=new u.xQ,this.collectionHasLayers=!1,this.warningMessage="",this.totalPackagesCount=0,this.currentMatchIndex=-1,this.currentMatchPosition=-1,this.searchTerm="",this.matchArray=[]}showAddPackagesDialog(){this.dialogController.dialogSubject.next({component:St.d,panelClass:"actions-dialog",data:{environmentId:"",collectionId:this.collectionId,selectedPackages:this.dataSource.data,actionName:"ADD PACKAGE(S)",actionDescription:"Please select package(s) to add to Recipe..."}}),this.editMode||(this.canSave=!1,this.editMode=!0,this.packagesCopy=j()(this.dataSource.data),this.isDirtyHash=this.computeHash(this.dataSource.data))}ngOnInit(){this.addPackageAction=new q.r,this.addPackageAction.tooltipTitle="Add or remove packages",this.addPackageAction.icon=this.icons.PLUS,this.addPackageAction.action=()=>{this.collectionId!==C.c.Empty?""!==this.collectionId?this.showAddPackagesDialog():this.notificationService.sendInfoMessage("Please save collection first",!0):this.notificationService.sendWarningMessage("Save recipe first",!0)},this.imageSubscription=this.imageSubject.imageSelected.subscribe(t=>{t&&(this.collectionId=t.recipeSelection.getRecipeId(),this.packagesList=[...t.packageList.entityPackages.map(o=>new X.q(!1,o.name,o.description,o.orderNumber,o.id))],this.finalizeLoadingPackages())}),this.collectionMediatorSubscription=this.collectionMediator.collectionSelected.subscribe(t=>{t&&(this.collectionId=t.id,this.collectionHasLayers=t.hasLayers,this.collectionHasLayers&&(this.warningMessage="Layers are present, please configure these using the old interface"),this.packagesList=null===t.packageList?[]:[...t.packageList.entityPackages.map(o=>new X.q(!1,o.name,o.description,o.orderNumber,o.id))],this.finalizeLoadingPackages())}),this.packagesChangedSubscription=this.imageSubject.packagesModified.subscribe(t=>{null!=t&&(this.packagesList=[...t.map(o=>new X.q(!1,o.name,o.description,o.orderNumber,o.id))],this.finalizeLoadingPackages(),this.canSave=this.isDirty())})}finalizeLoadingPackages(){this.dataSource.data=this.packagesList.sort((t,o)=>(0,Z.WQ)(t.orderNumber,o.orderNumber,!0)),this.totalPackagesCount=this.packagesList.length,this.isDirtyHash=pe(this.dataSource.data)}sortData(t){const o=[...this.dataSource.data.slice()];if(!t.active||""===t.direction)return void(this.dataSource.data=o);const n="asc"===t.direction;this.dataSource.data=o.sort((l,c)=>{switch(t.active){case"orderNumber":return(0,Z.WQ)(l.orderNumber,c.orderNumber,n);case"applicationName":return(0,Z.qu)(l.applicationName,c.applicationName,n);case"description":return(0,Z.qu)(l.description,c.description,n);default:return 0}})}calculateMatches(){this.matchArray.length=0,this.currentMatchIndex=-1,this.currentMatchPosition=-1,this.searchTerm&&(this.matchArray=this.dataSource.data.map((t,o)=>{const n=RegExp(this.searchTerm,"ig");return n.test(t.applicationName)||n.test(t.description)?o:-1}).filter(t=>t>=0))}applyFilter(t){this.searchTerm=t,this.calculateMatches()}get Description(){return`${this.totalPackagesCount} package${1!==this.totalPackagesCount?"s":""}`}rowClick(t){if(this.canSave=!1,t&&t.target){const o=t.target.tagName.toLowerCase().toString();if(["button","am_icon","svg","path"].indexOf(o)>=0)return void t.stopPropagation()}this.editMode||(this.editMode=!0,this.packagesCopy=j()(this.dataSource.data),this.isDirtyHash=this.computeHash(this.dataSource.data))}computeHash(t){const o=t.reduce((n,l)=>(n[l.id]=l.formControl.value,n),{});return pe(o)}isDirty(){const t=this.computeHash(this.dataSource.data),o=this.dataSource.data.filter(n=>!n.formControl.valid);return t!==this.isDirtyHash&&0===o.length}ngAfterViewInit(){this.onSearch.pipe((0,p.b)(500)).pipe((0,P.x)()).subscribe(o=>{this.applyFilter(o)}),this.nextMatchSubscription=this.nextMatch.subscribe(()=>{if(0!==this.matchArray.length){if(this.currentMatchPosition<0)return this.currentMatchPosition=0,void(this.currentMatchIndex=this.matchArray[this.currentMatchPosition]);this.currentMatchPosition++,this.currentMatchPosition===this.matchArray.length&&(this.currentMatchPosition=0),this.currentMatchIndex=this.matchArray[this.currentMatchPosition]}}),this.prevMatchSubscription=this.prevMatch.subscribe(()=>{if(0!==this.matchArray.length){if(0===this.currentMatchPosition)return this.currentMatchPosition=this.matchArray.length-1,void(this.currentMatchIndex=this.matchArray[this.currentMatchPosition]);this.currentMatchPosition--,this.currentMatchPosition<0&&(this.currentMatchPosition=this.matchArray.length-1),this.currentMatchIndex=this.matchArray[this.currentMatchPosition]}}),this.deleteSubscription=this.onDelete.pipe((0,p.b)(100),(0,p.b)(100)).subscribe(o=>{const n=this.packagesList.findIndex(l=>l.id===o.id);n>=0&&(this.packagesList.splice(n,1),this.dataSource.data=[...this.packagesList],this.totalPackagesCount=this.packagesList.length,this.canSave=this.isDirty(),this.calculateMatches())}),this.saveClickSubscription=this.onSaveClick.pipe((0,p.b)(500)).subscribe(()=>{this.editMode=!1;const o=this.dataSource.data.map(n=>({orderNumber:n.formControl.value,name:n.applicationName,id:n.id,description:n.description}));if(this.imageManagementHttpService.persistRecipePackages(this.collectionId,o).subscribe(()=>{this.calculateMatches()}),this.router.url===wt.l.getRecipeUrl(this.collectionId)){const n=this.imageSubject.imageSelected.getValue();n.packageList.entityPackages=o,this.imageSubject.imageSelected.next(n)}this.finishedWithPackages.next()}),this.cancelClickSubscription=this.onCancelClick.pipe((0,p.b)(500)).subscribe(()=>{this.editMode=!1,this.dataSource.data=[...this.packagesCopy],this.packagesCopy=[],this.finishedWithPackages.next()}),this.orderChangedSubject=this.onOrderChanged.pipe((0,p.b)(500)).pipe((0,P.x)()).subscribe(o=>{if(o.pckg.orderNumber=o.pckg.formControl.value,o.pckg.formControl.setErrors(null),!o.pckg.formControl.valid)return;if(!o.term.trim())return void o.pckg.formControl.setErrors({required:"required"});let n=Number(o.term.trim());if(isNaN(n))return void o.pckg.formControl.setErrors({number:"number"});if(n<0&&o.pckg.formControl.setErrors({negative:"negative"}),this.dataSource.data[o.idx]){if(this.dataSource.data[o.idx].orderNumber===n)return;this.dataSource.data[o.idx].orderNumber=n,this.dataSource.data[o.idx].formControl.setValue(n)}const l=this.dataSource.data.findIndex(c=>c.id!==o.pckg.id&&c.orderNumber===n);if(l>=0){let c=0;c=l>0?l-1:0===l?0:l,this.dataSource.data.splice(c,0,this.dataSource.data[o.idx]),this.dataSource.data.splice(o.idx+1,1);for(let m=c+1;m<this.dataSource.data.length;m+=1)this.dataSource.data[m].orderNumber=++n,this.dataSource.data[m].formControl.setValue(n)}"orderNumber"===this.sort.active&&(this.dataSource.data=this.dataSource.data.sort((c,m)=>(0,Z.WQ)(c.orderNumber,m.orderNumber,"asc"===this.sort.direction))),this.canSave=this.isDirty(),this.calculateMatches()})}ngOnDestroy(){this.imageSubscription&&this.imageSubscription.unsubscribe(),this.deleteSubscription&&this.deleteSubscription.unsubscribe(),this.packagesChangedSubscription&&this.packagesChangedSubscription.unsubscribe(),this.saveClickSubscription&&this.saveClickSubscription.unsubscribe(),this.cancelClickSubscription&&this.cancelClickSubscription.unsubscribe(),this.orderChangedSubject&&this.orderChangedSubject.unsubscribe(),this.nextMatchSubscription&&this.nextMatchSubscription.unsubscribe(),this.prevMatchSubscription&&this.prevMatchSubscription.unsubscribe(),this.collectionMediatorSubscription&&this.collectionMediatorSubscription.unsubscribe(),this.imageSubject.packagesModified.next(null)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(xt.Y),e.Y36(Zt.f),e.Y36(Y.T),e.Y36(Mt.Y),e.Y36(T),e.Y36(L.w),e.Y36(v.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["collection-package-list"]],viewQuery:function(t,o){if(1&t&&e.Gf(y.YE,5),2&t){let n;e.iGM(n=e.CRH())&&(o.sort=n.first)}},inputs:{isDetailed:"isDetailed"},decls:28,vars:14,consts:[[3,"action","counter","title","description","warningMessage"],["pre-actions","",1,"pull-right","pt-2"],[1,"full-width"],["matPrefix","",1,"mr-3"],[1,"far","fa-search"],["matInput","","placeholder","Enter your search term...",3,"keyup"],["matSuffix","",1,"mr-1","pointer",3,"click"],[1,"fas","fa-caret-up","fa-lg"],[1,"fas","fa-caret-down","fa-lg"],["readonly-view",""],[1,"ps-show-always"],["matSort","","matSortActive","orderNumber","matSortDirection","asc","matSortDisableClear","",3,"dataSource","matSortChange"],["matColumnDef","orderNumber"],["style","max-width: 10%; width:10%","class","pl-3 marker-column text-capitalize","mat-sort-header","",4,"matHeaderCellDef"],["style","max-width: 10%; width:10%","class","text-center pl-4 pr-3",4,"matCellDef"],["matColumnDef","applicationName"],["style","max-width: 40%; width:40%","mat-sort-header","",4,"matHeaderCellDef"],["style","max-width: 40%; width:40%",4,"matCellDef"],["matColumnDef","description"],["style","max-width: 40%; width:40%","class","pl-3","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","action"],["style","max-width: 10%; width:10%","class","pl-3","mat-sort-header","",4,"matHeaderCellDef"],["class","text-right","style","max-width: 10%; width:10%",4,"matCellDef"],["class","pl-0",4,"matHeaderRowDef","matHeaderRowDefSticky"],["class","pl-0 pr-0 pointer",3,"ngClass","matched","click",4,"matRowDef","matRowDefColumns"],[4,"ngIf"],["mat-sort-header","",1,"pl-3","marker-column","text-capitalize",2,"max-width","10%","width","10%"],[1,"text-center","pl-4","pr-3",2,"max-width","10%","width","10%"],["matInput","","name","orderNumber",3,"formControl","keyup"],["mat-sort-header","",2,"max-width","40%","width","40%"],[2,"max-width","40%","width","40%"],[1,"highlight",3,"innerHtml"],["mat-sort-header","",1,"pl-3",2,"max-width","40%","width","40%"],["mat-sort-header","",1,"pl-3",2,"max-width","10%","width","10%"],[1,"text-right",2,"max-width","10%","width","10%"],["mat-button","",3,"click",4,"ngIf"],["mat-button","",3,"click"],["title","Remove package",3,"iconClasses"],[1,"pl-0"],[1,"pl-0","pr-0","pointer",3,"ngClass","click"],[1,"footer",2,"margin-top","2px"],[1,"container",2,"background","#eeeeee","box-shadow","0 2px 2px 0 rgba(97, 97, 97, 0.5)"],[1,"row","mt-0","pointer"],[1,"col","pt-2","pb-2","text-right"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"disabled","click"]],template:function(t,o){1&t&&(e.TgZ(0,"form-section",0),e.TgZ(1,"div",1),e.TgZ(2,"mat-form-field",2),e.TgZ(3,"span",3),e._UZ(4,"i",4),e.qZA(),e.TgZ(5,"input",5),e.NdJ("keyup",function(l){return o.onSearch.next(l.target.value)}),e.qZA(),e.TgZ(6,"span",6),e.NdJ("click",function(l){return o.prevMatch.next(l)}),e._UZ(7,"i",7),e.qZA(),e.TgZ(8,"span",6),e.NdJ("click",function(l){return o.nextMatch.next(l)}),e._UZ(9,"i",8),e.qZA(),e.qZA(),e.qZA(),e.TgZ(10,"div",9),e.TgZ(11,"perfect-scrollbar",10),e.TgZ(12,"mat-table",11),e.NdJ("matSortChange",function(l){return o.sortData(l)}),e.ynx(13,12),e.YNc(14,yt,2,0,"mat-header-cell",13),e.YNc(15,Ft,3,2,"mat-cell",14),e.BQk(),e.ynx(16,15),e.YNc(17,qt,2,0,"mat-header-cell",16),e.YNc(18,Et,3,6,"mat-cell",17),e.BQk(),e.ynx(19,18),e.YNc(20,Lt,2,0,"mat-header-cell",19),e.YNc(21,Qt,3,6,"mat-cell",17),e.BQk(),e.ynx(22,20),e.YNc(23,Jt,1,0,"mat-header-cell",21),e.YNc(24,Ot,2,1,"mat-cell",22),e.BQk(),e.YNc(25,Ht,1,0,"mat-header-row",23),e.YNc(26,Rt,1,3,"mat-row",24),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.YNc(27,Vt,9,1,"div",25)),2&t&&(e.Q6J("action",o.addPackageAction)("counter",3)("title","PACKAGE LIST")("description",o.Description)("warningMessage",o.warningMessage),e.xp6(6),e.ekj("invisible",0==o.matchArray.length),e.xp6(2),e.ekj("invisible",0==o.matchArray.length),e.xp6(4),e.Q6J("dataSource",o.dataSource),e.xp6(13),e.Q6J("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumns),e.xp6(1),e.Q6J("ngIf",o.editMode))},directives:[k.A,_.KE,_.qo,N.Nt,_.R9,Q.Vv,r.BZ,y.YE,r.w1,r.fO,r.ge,y.nU,r.Dz,r.ev,S.O5,h.Fj,h.JJ,h.oH,_.TO,D.lW,V.b,r.as,r.XQ,r.nj,r.Gk,S.mk],pipes:[At.W],styles:[".matched[_ngcontent-%COMP%]{background-color:#e4e4e4!important}.highlight[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{background-color:#ffff04;font-weight:400}.highlight.current[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{background-color:#ff8b2c;font-weight:400}mat-header-cell[_ngcontent-%COMP%]   .mat-sort-header-button[_ngcontent-%COMP%]{text-transform:capitalize!important}.mat-form-field[_ngcontent-%COMP%]{font-size:12px}"]}),i})();class jt{constructor(){this.runOnceSetting=!1,this.runEveryBootSetting=!1,this.runEveryBootSecuritySetting=!1,this.forceRebootSetting=!1,this.moveComputersToOuSetting=!1,this.moveComputersToOuPath="",this.enableAutoCreateSetting=!1,this.moveComputersToOuPathFormControl=new h.NI}}var Ce=s(90455),fe=s(56709);const Bt=["path"];function $t(i,a){1&i&&(e.TgZ(0,"mat-header-cell",26),e._uU(1,"Update "),e.qZA())}function Gt(i,a){1&i&&e._UZ(0,"mat-cell",27)}function Wt(i,a){1&i&&e._UZ(0,"mat-header-cell")}function zt(i,a){1&i&&e._UZ(0,"mat-cell",28)}function Xt(i,a){1&i&&e._UZ(0,"mat-header-row",29)}function Kt(i,a){1&i&&e._UZ(0,"mat-row",29)}const eo=function(){return[]};let to=(()=>{class i{constructor(t,o,n){this.collectionMediator=t,this.messagingService=o,this.collectionManagerHttpService=n,this.icons=M.R.icons.fontAwesome,this.displayedColumns=["name","value"],this.viewModel=new jt,this.editMode=!1,this.subscription=new w.w,this.onPathChange=new u.xQ,this.onSettingChange=new u.xQ}ngOnInit(){R.h.currentEnvironment.subscribe(n=>{this.selectedEnvironment=n});const o=this.collectionMediator.collectionSelected.pipe((0,b.h)(n=>null!=n)).subscribe(n=>{this.collectionId=n.id,this.bindToModel(n)});this.subscription.add(o),this.onPathChangeSubscription=this.onPathChange.pipe((0,p.b)(600)).pipe((0,P.x)()).subscribe(n=>{""!==this.viewModel.id&&(this.viewModel.moveComputersToOuPath=n,this.saveConfigurationChanges())}),this.subscription.add(this.onPathChangeSubscription),this.onSettingChangeSubscription=this.onSettingChange.pipe((0,p.b)(600)).pipe((0,P.x)()).subscribe(n=>{this.viewModel[n.name]=n.value,this.saveConfigurationChanges()})}saveConfigurationChanges(){this.collectionManagerHttpService.saveCollectionSettings(this.selectedEnvironment.id,this.collectionId,this.viewModel.runOnceSetting,this.viewModel.runEveryBootSetting,this.viewModel.runEveryBootSecuritySetting,this.viewModel.forceRebootSetting,this.viewModel.moveComputersToOuSetting,this.viewModel.moveComputersToOuPath,this.viewModel.enableAutoCreateSetting).subscribe(t=>{})}checkIfNewCollection(t){""!==this.viewModel.id||t.preventDefault()}onSettingClicked(t){if(""===this.viewModel.id)return this.messagingService.sendInfoMessage("Please save collection first"),t.preventDefault(),void this.pathField.nativeElement.blur()}onSettingChanged(t,o){this.onSettingChange.next({name:t,value:o.checked})}ngOnDestroy(){this.subscription.unsubscribe()}bindToModel(t){this.viewModel.id=t.id,this.viewModel.runOnceSetting=t.runOnceSetting,this.viewModel.runEveryBootSecuritySetting=t.runEveryBootSecuritySetting,this.viewModel.runEveryBootSetting=t.runEveryBootSetting,this.viewModel.enableAutoCreateSetting=t.enableAutoCreateSetting,this.viewModel.forceRebootSetting=t.forceRebootSetting,this.viewModel.moveComputersToOuPath=t.moveComputersToOuPath,this.viewModel.moveComputersToOuSetting=t.moveComputersToOuSetting,this.viewModel.moveComputersToOuPathFormControl.setValue(t.moveComputersToOuPath)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(T),e.Y36(L.w),e.Y36(x.$))},i.\u0275cmp=e.Xpm({type:i,selectors:[["collection-settings"]],viewQuery:function(t,o){if(1&t&&e.Gf(Bt,5),2&t){let n;e.iGM(n=e.CRH())&&(o.pathField=n.first)}},decls:40,vars:14,consts:[[3,"counter","title","description"],["body",""],[3,"dataSource"],["table",""],["matColumnDef","name"],["class","pl-3 name-cell",4,"matHeaderCellDef"],["class","text-left pl-3 pt-2 pb-2 name-cell",4,"matCellDef"],["matColumnDef","value"],[4,"matHeaderCellDef"],["class","text-left pt-2 pb-2 border-left",4,"matCellDef"],["class","pl-0",4,"matHeaderRowDef"],["class","pl-0",4,"matRowDef","matRowDefColumns"],["readonly-view",""],[1,"mt-0","pointer","no-gutters","align-items-center","background"],[1,"col","pt-3","pb-2","settings-item","odd"],["color","primary",3,"checked","click","change"],[1,"col","pt-3","pb-2","settings-item","even"],[1,"col","pt-3","pb-2","settings-item","even","full-width"],[1,"option-content"],[1,"option-element"],[1,"path-form",3,"floatLabel"],["name","path","matInput","","placeholder","Path",3,"formControl","click","keydown","keyup"],["path",""],[1,"option-element-right"],[3,"checked","click","change"],[1,"pre-footer","mb-0","mt-0","pt-1","pb-0","pl-2","pr-2"],[1,"pl-3","name-cell"],[1,"text-left","pl-3","pt-2","pb-2","name-cell"],[1,"text-left","pt-2","pb-2","border-left"],[1,"pl-0"]],template:function(t,o){1&t&&(e.TgZ(0,"form-section",0),e.TgZ(1,"div",1),e.TgZ(2,"mat-table",2,3),e.ynx(4,4),e.YNc(5,$t,2,0,"mat-header-cell",5),e.YNc(6,Gt,1,0,"mat-cell",6),e.BQk(),e.ynx(7,7),e.YNc(8,Wt,1,0,"mat-header-cell",8),e.YNc(9,zt,1,0,"mat-cell",9),e.BQk(),e.YNc(10,Xt,1,0,"mat-header-row",10),e.YNc(11,Kt,1,0,"mat-row",11),e.qZA(),e.qZA(),e.TgZ(12,"div",12),e.TgZ(13,"div",13),e.TgZ(14,"div",14),e.TgZ(15,"mat-slide-toggle",15),e.NdJ("click",function(l){return o.onSettingClicked(l)})("change",function(l){return o.onSettingChanged("runOnceSetting",l)}),e._uU(16,'Enable "Run once" section'),e.qZA(),e.qZA(),e.TgZ(17,"div",16),e.TgZ(18,"mat-slide-toggle",15),e.NdJ("click",function(l){return o.onSettingClicked(l)})("change",function(l){return o.onSettingChanged("runEveryBootSetting",l)}),e._uU(19,'Enable "Run every boot" section'),e.qZA(),e.qZA(),e.TgZ(20,"div",14),e.TgZ(21,"mat-slide-toggle",15),e.NdJ("click",function(l){return o.onSettingClicked(l)})("change",function(l){return o.onSettingChanged("runEveryBootSecuritySetting",l)}),e._uU(22,'Enable "Run every boot (security)" section'),e.qZA(),e.qZA(),e.TgZ(23,"div",16),e.TgZ(24,"mat-slide-toggle",15),e.NdJ("click",function(l){return o.onSettingClicked(l)})("change",function(l){return o.onSettingChanged("forceRebootSetting",l)}),e._uU(25,"Force reboot after deployment"),e.qZA(),e.qZA(),e.TgZ(26,"div",17),e.TgZ(27,"mat-slide-toggle",15),e.NdJ("click",function(l){return o.onSettingClicked(l)})("change",function(l){return o.onSettingChanged("moveComputersToOuSetting",l)}),e.TgZ(28,"div",18),e.TgZ(29,"div",19),e._uU(30," Move computers to OU (Organisational Unit): "),e.qZA(),e.TgZ(31,"div",19),e.TgZ(32,"mat-form-field",20),e.TgZ(33,"input",21,22),e.NdJ("click",function(l){return o.onSettingClicked(l)})("keydown",function(l){return o.checkIfNewCollection(l)})("keyup",function(l){return o.onPathChange.next(l.target.value)}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(35,"div",23),e.TgZ(36,"mat-checkbox",24),e.NdJ("click",function(l){return o.onSettingClicked(l)})("change",function(l){return o.onSettingChanged("enableAutoCreateSetting",l)}),e._uU(37,"Enable auto create"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(38,"p",25),e._uU(39," \xa0\n"),e.qZA()),2&t&&(e.Q6J("counter",4)("title","SETTINGS"),e.xp6(2),e.Q6J("dataSource",e.DdM(13,eo)),e.xp6(8),e.Q6J("matHeaderRowDef",o.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumns),e.xp6(4),e.Q6J("checked",o.viewModel.runOnceSetting),e.xp6(3),e.Q6J("checked",o.viewModel.runEveryBootSetting),e.xp6(3),e.Q6J("checked",o.viewModel.runEveryBootSecuritySetting),e.xp6(3),e.Q6J("checked",o.viewModel.forceRebootSetting),e.xp6(3),e.Q6J("checked",o.viewModel.moveComputersToOuSetting),e.xp6(5),e.Q6J("floatLabel","never"),e.xp6(1),e.Q6J("formControl",o.viewModel.moveComputersToOuPathFormControl),e.xp6(3),e.Q6J("checked",o.viewModel.enableAutoCreateSetting))},directives:[k.A,r.BZ,r.w1,r.fO,r.ge,r.Dz,r.ev,r.as,r.XQ,r.nj,r.Gk,Ce.Rr,_.KE,N.Nt,h.Fj,h.JJ,h.oH,fe.oG],styles:[".name-cell[_ngcontent-%COMP%]{max-width:230px}.border-left[_ngcontent-%COMP%]{border-left:1px solid #E4E4E4}.background[_ngcontent-%COMP%]{background:#FFFFFF}.settings-item[_ngcontent-%COMP%]{padding-left:20px;border-bottom:1px solid #E4E4E4;width:100%}.odd[_ngcontent-%COMP%]{background:#ffffff}.even[_ngcontent-%COMP%]{background:#fbfbfb}.option-element[_ngcontent-%COMP%]{display:inline}.option-element-right[_ngcontent-%COMP%]{display:inline;float:right;padding-top:17px;padding-right:13px}.option-content[_ngcontent-%COMP%]{width:100%;padding-top:6px}.path-form[_ngcontent-%COMP%]{width:35%}"]}),i})();function oo(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"collection-details",7),e.NdJ("modelChanged",function(n){return e.CHM(t),e.oxw().onCollectionInfoChanged(n)}),e.qZA(),e.TgZ(2,"div",8),e.NdJ("click",function(){return e.CHM(t),e.oxw().onDisabledAreaClicked()}),e._UZ(3,"collection-computer-list"),e._UZ(4,"collection-package-list"),e._UZ(5,"collection-settings"),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(2),e.ekj("isDisabled",t.isInfoUrlActive)}}let _e=(()=>{class i{constructor(t,o,n,l,c,m,g,U){this.collectionManagerService=t,this.collectionTypeService=o,this.router=n,this.route=l,this.dialogService=c,this.messagingService=m,this.matDialog=g,this.hotkeysService=U,this.subscription=new w.w,this.isLoading=!0,this.icons=M.R.icons.fontAwesome,this.tabs=[new B.f("Collection Details",this.router.url)],this.resolveIdFromUrl(),this.handleNewCollectionLoading(),this.isInfoUrlActive=this.router.url===`${d.getCollectionInfoUrl(this.collectionId)}`}ngOnInit(){this.hotkeysService.add(new f.qm("esc",()=>(this.collectionPackageListComponent.editMode?this.collectionPackageListComponent.onCancelClick.next(new KeyboardEvent("keydown")):d.getCollectionUrl(this.collectionId)===this.router.url&&0===this.matDialog.openDialogs.length?this.navigateToCollectionList():d.getCollectionInfoUrl(this.collectionId)===this.router.url&&this.collectionDetailsComponent.cancelChanges(),!1),F.C.hotkeysAllowIn,"Back to collections / Cancel changes")),this.hotkeysService.add(new f.qm("ctrl+s",()=>(this.collectionPackageListComponent.editMode&&this.collectionPackageListComponent.canSave?this.collectionPackageListComponent.onSaveClick.next(new KeyboardEvent("keydown")):d.getCollectionInfoUrl(this.collectionId)===this.router.url&&this.collectionDetailsComponent.allowSave&&this.collectionDetailsComponent.saveChanges(),!1),F.C.hotkeysAllowIn,"Save changes")),this.hotkeysService.add(new f.qm("alt+n",()=>(!this.collectionDetailsComponent.isEditMode&&!this.collectionPackageListComponent.editMode&&0===this.matDialog.openDialogs.length&&this.collectionComputerListComponent.addComputer(),!1),[],"Add a new computer")),this.hotkeysService.add(new f.qm("alt+m",()=>(!this.collectionDetailsComponent.isEditMode&&!this.collectionPackageListComponent.editMode&&0===this.matDialog.openDialogs.length&&this.collectionPackageListComponent.showAddPackagesDialog(),!1),[],"Add / remove packages")),this.subscription.add(this.collectionManagerService.collectionSelected.subscribe(t=>{!C.c.isEmpty(this.collectionId)&&(null==t||t.id!==this.collectionId)&&this.subscription.add(this.collectionManagerService.fetchCollection(this.collectionId)),null!=t&&(this.isLoading=!1)})),this.subscription.add(this.collectionManagerService.collectionInfoUnsaved.subscribe(t=>{this.collectionInfoUnsaved=t}))}resolveIdFromUrl(){if(this.collectionId=null,this.router.url.startsWith(`${d.collectionsUrl}/`)){const o=this.route.snapshot.paramMap.get("id");C.c.isGuidFormat(o)&&(this.collectionId=o)}}handleNewCollectionLoading(){if(C.c.isEmpty(this.collectionId)){const t=new Xe;t.id=C.c.Empty,this.collectionManagerService.collectionSelected.next(t)}}canDeactivate(){if(this.collectionInfoUnsaved){const t=new u.xQ;return this.dialogService.openDialog("Do you want to save changes?","Your changes will be lost if you don't save them.",null!=this.collectionInfoModel).subscribe(o=>{if("Confirmed"===o)return this.collectionManagerService.saveCollectionInfo(this.collectionInfoModel).subscribe(n=>{t.next(n.succeeded)});"UnConfirmed"===o?t.next(!0):"Canceled"===o&&t.next(!1)}),t.asObservable()}return!0}onCollectionInfoChanged(t){this.collectionInfoModel=t}onDisabledAreaClicked(){C.c.isEmpty(this.collectionId)?this.messagingService.sendInfoMessage("Please save collection info first",!0):this.router.navigate([d.getCollectionUrl(this.collectionId)])}navigateToCollectionList(){this.collectionPackageListComponent.editMode&&this.collectionPackageListComponent.canSave?(this.collectionPackageListComponent.finishedWithPackages.subscribe(()=>{this.collectionManagerService.navigateToCollectionList()}),this.dialogService.openDialog("Do you want to save changes?","Your changes will be lost if you don't save them.").subscribe(t=>{if("Confirmed"===t)this.collectionPackageListComponent.onSaveClick.next();else if("UnConfirmed"===t)this.collectionPackageListComponent.onCancelClick.next();else if("Canceled"===t)return})):this.collectionManagerService.navigateToCollectionList()}ngOnDestroy(){this.subscription.unsubscribe(),this.router.url.startsWith(d.getCollectionUrl(this.collectionId))||this.collectionManagerService.collectionSelected.next(null),this.hotkeysService.remove(this.hotkeysService.hotkeys.filter(t=>"esc"===t.combo[0]||"ctrl+s"===t.combo[0]||"alt+n"===t.combo[0]||"alt+m"===t.combo[0]))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(T),e.Y36(re),e.Y36(v.F0),e.Y36(v.gz),e.Y36(G.S),e.Y36(L.w),e.Y36(A.uw),e.Y36(f.tm))},i.\u0275cmp=e.Xpm({type:i,selectors:[["collection-details-manager"]],viewQuery:function(t,o){if(1&t&&(e.Gf(me,5),e.Gf(he,5),e.Gf(ge,5)),2&t){let n;e.iGM(n=e.CRH())&&(o.collectionDetailsComponent=n.first),e.iGM(n=e.CRH())&&(o.collectionComputerListComponent=n.first),e.iGM(n=e.CRH())&&(o.collectionPackageListComponent=n.first)}},decls:8,vars:5,consts:[[1,"container"],[1,"col-lg-11","offset-lg-1"],[3,"tabs"],["mat-button","",1,"mt-1",3,"click"],[3,"iconClasses","title"],[3,"loading"],[4,"ngIf"],[3,"modelChanged"],[3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._UZ(2,"am-page-tabs",2),e.TgZ(3,"button",3),e.NdJ("click",function(){return o.navigateToCollectionList()}),e._UZ(4,"am-icon",4),e._uU(5," Back to Collections "),e.qZA(),e._UZ(6,"loading-container",5),e.YNc(7,oo,6,2,"div",6),e.qZA(),e.qZA()),2&t&&(e.xp6(2),e.Q6J("tabs",o.tabs),e.xp6(2),e.Q6J("iconClasses",o.icons.CHEVRON_LEFT)("title","Back"),e.xp6(2),e.Q6J("loading",o.isLoading),e.xp6(1),e.Q6J("ngIf",!o.isLoading))},directives:[W.a,D.lW,V.b,ae.o,S.O5,me,he,ge,to],styles:[""]}),i})();var ve=s(76970),io=s(47861),no=s(29950),lo=s(75870),ao=s(11481);function so(i,a){1&i&&(e.TgZ(0,"span"),e._UZ(1,"i",10),e.qZA())}function co(i,a){1&i&&(e.TgZ(0,"span"),e._UZ(1,"i",11),e.qZA())}function ro(i,a){1&i&&(e.TgZ(0,"span"),e._UZ(1,"i",12),e.qZA())}function mo(i,a){if(1&i&&(e.TgZ(0,"span",7),e.YNc(1,so,2,0,"span",8),e.YNc(2,co,2,0,"span",8),e.YNc(3,ro,2,0,"span",8),e.TgZ(4,"i"),e._UZ(5,"span",9),e.qZA(),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.status==t.testConnectionStatusEnum.InProgress),e.xp6(1),e.Q6J("ngIf",t.status==t.testConnectionStatusEnum.Succeeded),e.xp6(1),e.Q6J("ngIf",t.status==t.testConnectionStatusEnum.Failed),e.xp6(2),e.Q6J("innerHtml",t.sanitizedMessage,e.oJD)}}let uo=(()=>{class i{constructor(t){this.sanitizer=t,this.onTestClick=new u.xQ,this.onCancelClick=new u.xQ,this.onSubmitClick=new u.xQ,this.onSubmit=new e.vpe,this.onCancel=new e.vpe,this.onTest=new e.vpe,this.testConnectionStatusEnum=lo.C}get sanitizedMessage(){return null==this.message?null:this.sanitizer.bypassSecurityTrustHtml(this.message)}ngOnInit(){}ngAfterViewInit(){this.submitClickSubscription=this.onSubmitClick.pipe((0,p.b)(300)).subscribe(()=>{this.onSubmit.emit()}),this.cancelClickSubscription=this.onCancelClick.pipe((0,p.b)(300)).subscribe(()=>{this.onCancel.emit()}),this.testClickSubscription=this.onTestClick.pipe((0,p.b)(300)).subscribe(()=>{this.onTest.emit()})}ngOnDestroy(){this.submitClickSubscription&&this.submitClickSubscription.unsubscribe(),this.cancelClickSubscription&&this.cancelClickSubscription.unsubscribe(),this.testClickSubscription&&this.testClickSubscription.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(ao.H7))},i.\u0275cmp=e.Xpm({type:i,selectors:[["test-connection-footer"]],inputs:{testEnabled:"testEnabled",saveEnabled:"saveEnabled",message:"message",status:"status",isSubmitEnabled:"isSubmitEnabled"},outputs:{onSubmit:"onSubmit",onCancel:"onCancel",onTest:"onTest"},decls:10,vars:2,consts:[[1,"row","mt-0","pointer"],[1,"col-lg-9","pt-2","pb-2","text-left"],["mat-raised-button","",1,"pull-left",3,"click"],["class","pl-3 pull-left",4,"ngIf"],[1,"col","pt-2","pb-2","text-right"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"disabled","click"],[1,"pl-3","pull-left"],[4,"ngIf"],[3,"innerHtml"],[1,"fas","fa-spinner","fa-spin"],[1,"far","fa-check","text-success"],[1,"fas","fa-times-circle","text-error"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"button",2),e.NdJ("click",function(l){return o.onTestClick.next(l)}),e._uU(3," TEST "),e.qZA(),e.YNc(4,mo,6,4,"span",3),e.qZA(),e.TgZ(5,"div",4),e.TgZ(6,"button",5),e.NdJ("click",function(l){return o.onCancelClick.next(l)}),e._uU(7," CANCEL "),e.qZA(),e.TgZ(8,"button",6),e.NdJ("click",function(l){return o.onSubmitClick.next(l)}),e._uU(9," SAVE "),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(4),e.Q6J("ngIf",o.status!=o.testConnectionStatusEnum.NotStarted),e.xp6(4),e.Q6J("disabled",!o.isSubmitEnabled))},directives:[D.lW,S.O5],styles:["i[_ngcontent-%COMP%]{font-weight:300;color:#616161}.pre-footer[_ngcontent-%COMP%]{background:#E4E4E4;box-shadow:0 2px 2px #61616180}"]}),i})();function ho(i,a){1&i&&(e.TgZ(0,"mat-header-cell",17),e._uU(1,"Service Account "),e.qZA())}function po(i,a){1&i&&e._UZ(0,"mat-cell",18)}function go(i,a){1&i&&(e.TgZ(0,"mat-header-cell",19),e._uU(1,"Password "),e.qZA())}function Co(i,a){1&i&&e._UZ(0,"mat-cell")}function fo(i,a){1&i&&(e.TgZ(0,"mat-header-cell",20),e._uU(1," Domain FQDN"),e.qZA())}function _o(i,a){1&i&&e._UZ(0,"mat-cell")}function vo(i,a){1&i&&e._UZ(0,"mat-header-row",21)}function bo(i,a){1&i&&e._UZ(0,"mat-row",21)}function So(i,a){1&i&&(e.TgZ(0,"span"),e._uU(1," \u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022 "),e.qZA())}function wo(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",22),e.TgZ(1,"div",23),e.NdJ("click",function(){return e.CHM(t),e.oxw().enableEditMode()}),e.TgZ(2,"div",24),e._uU(3),e.qZA(),e.TgZ(4,"div",25),e.YNc(5,So,2,0,"span",26),e.qZA(),e.TgZ(6,"div",25),e._uU(7),e.qZA(),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(3),e.hij(" ",t.model.serviceAccount," "),e.xp6(2),e.Q6J("ngIf",t.model.password),e.xp6(2),e.hij(" ",t.model.fqdn," ")}}function To(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Service Account is required "),e.qZA())}function xo(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Incorrect Service Account format "),e.qZA())}function Zo(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Password is required "),e.qZA())}function Mo(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Please enter a valid FQDN "),e.qZA())}function Ao(i,a){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Server is required "),e.qZA())}function yo(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",22),e.TgZ(1,"div",27),e.TgZ(2,"div",28),e.TgZ(3,"mat-form-field",29),e.TgZ(4,"input",30),e.NdJ("ngModelChange",function(){return e.CHM(t),e.oxw().onInputChange()}),e.qZA(),e.TgZ(5,"mat-hint"),e._uU(6,"Example: domain\\username"),e.qZA(),e.YNc(7,To,2,0,"mat-error",26),e.YNc(8,xo,2,0,"mat-error",26),e.qZA(),e.qZA(),e.TgZ(9,"div",31),e.TgZ(10,"mat-form-field",29),e.TgZ(11,"input",32),e.NdJ("ngModelChange",function(){return e.CHM(t),e.oxw().onInputChange()})("focus",function(){return e.CHM(t),e.oxw().setPasswordValue(!0)})("blur",function(){return e.CHM(t),e.oxw().setPasswordValue(!1)}),e.qZA(),e.YNc(12,Zo,2,0,"mat-error",26),e.qZA(),e.qZA(),e.TgZ(13,"div",31),e.TgZ(14,"mat-form-field",29),e.TgZ(15,"input",33),e.NdJ("ngModelChange",function(){return e.CHM(t),e.oxw().onInputChange()}),e.qZA(),e.TgZ(16,"mat-hint"),e._uU(17,"Example: loginvsi.com"),e.qZA(),e.YNc(18,Mo,2,0,"mat-error",26),e.YNc(19,Ao,2,0,"mat-error",26),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("floatLabel","never"),e.xp6(1),e.s9C("maxlength",t.model.serviceAccountMaxLength),e.Q6J("formControl",t.model.serviceAccountFormControl),e.xp6(3),e.Q6J("ngIf",t.model.serviceAccountFormControl.hasError("required")),e.xp6(1),e.Q6J("ngIf",t.model.serviceAccountFormControl.hasError("pattern")),e.xp6(2),e.Q6J("floatLabel","never"),e.xp6(1),e.Q6J("formControl",t.model.passwordFormControl),e.xp6(1),e.Q6J("ngIf",t.model.passwordFormControl.hasError("required")),e.xp6(2),e.Q6J("floatLabel","never"),e.xp6(1),e.Q6J("formControl",t.model.fqdnFormControl),e.xp6(3),e.Q6J("ngIf",t.model.fqdnFormControl.hasError("isFQDN")&&!t.model.fqdnFormControl.hasError("required")),e.xp6(1),e.Q6J("ngIf",t.model.fqdnFormControl.hasError("required"))}}function ko(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",34),e.TgZ(1,"test-connection-footer",35),e.NdJ("onCancel",function(){return e.CHM(t),e.oxw().cancelChanges()})("onTest",function(){return e.CHM(t),e.oxw().onTestAdAccountConnection()})("onSubmit",function(){return e.CHM(t),e.oxw().commitChanges()}),e.qZA(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("status",t.model.testResponse.status)("message",t.model.testResponse.message)("isSubmitEnabled",t.allowSave)}}const Do=function(){return[]};let Uo=(()=>{class i{constructor(t,o,n,l,c){this.collectionManagerService=t,this.collectionManagerHttpService=o,this.dataRepositoryService=n,this.router=l,this.hotkeysService=c,this.modelChanged=new e.vpe,this.icons=M.R.icons.fontAwesome,this.displayedColumns=["svcaccount","password","fqdn"],this.editMode=!1,this.serviceAccountErrorMessage="Service account is not valid.",this.localAdminAccountErrorMessage="Local admin account is not valid.",this.fakeServiceAccountPassword="password",this.subscription=new w.w,this.model=new io.v,this.resolveUrl()}ngOnInit(){this.hotkeysService.add(new f.qm("alt+t",()=>(d.adConfigurationUrl===this.router.url&&this.onTestAdAccountConnection(),!1),F.C.hotkeysAllowIn,"Test connection")),this.hotkeysService.add(new f.qm("esc",()=>(d.adConfigurationUrl===this.router.url&&this.cancelChanges(),!1),F.C.hotkeysAllowIn,"Cancel changes")),this.hotkeysService.add(new f.qm("ctrl+s",()=>(d.adConfigurationUrl===this.router.url&&this.allowSave&&this.commitChanges(),!1),F.C.hotkeysAllowIn,"Save changes")),this.subscription.add(this.dataRepositoryService.currentEnvironmentSubject.pipe((0,b.h)(t=>null!=t)).subscribe(t=>{this.environmentId=t.id})),this.configSubscription=this.collectionManagerService.configurationLoaded.pipe((0,b.h)(t=>null!=t)).subscribe(t=>{this.setModelValues(t),this.modelClone=j()(this.model)})}resolveUrl(){this.router.url===d.adConfigurationUrl&&(this.editMode=!0)}setModelValues(t){this.model.setServiceAccount(t.username),this.model.setServiceAccountPassword(!0!==t.isPasswordSet?t.password:this.fakeServiceAccountPassword),this.model.setFqdn(t.domainFqdn),this.model.resetControls(),this.model.resetDirty(),this.isServiceAccountPasswordSet=t.isPasswordSet}onInputChange(){this.model.fqdn=this.model.fqdnFormControl.value,this.model.password=this.model.passwordFormControl.value,this.model.serviceAccount=this.model.serviceAccountFormControl.value,this.collectionManagerService.adConfigurationUnsaved.next(this.model.fqdnFormControl.value!==this.modelClone.fqdn||this.model.serviceAccountFormControl.value!==this.modelClone.serviceAccount||this.model.passwordFormControl.dirty),this.modelChanged.emit(this.model)}cancelChanges(){this.collectionManagerService.adConfigurationUnsaved.next(!1),this.navigatToConfiguration()}onTestAdAccountConnection(){this.model.testConnectionProgress("Testing connection to Active Directory");const t=new no.I;t.serviceAccount=this.model.serviceAccountFormControl.value,t.serviceAccountPassword=this.model.passwordFormControl.value!==this.fakeServiceAccountPassword?this.model.passwordFormControl.value:"",t.domainFqdn=this.model.fqdnFormControl.value,this.collectionManagerHttpService.testAccountConfiguration(this.environmentId,t).subscribe(o=>{if(o.isAdAccountValid&&o.isLocalAccountValid)this.model.testConnectionSucceeded("Test connection succeeded"),this.model.resetTestConnection();else{let n="";o.isAdAccountValid||(n+=this.serviceAccountErrorMessage),o.isLocalAccountValid||(n+=" "+this.localAdminAccountErrorMessage),this.model.testConnectionFailed(n)}})}commitChanges(){this.collectionManagerService.saveActiveDirectoryConfiguration(this.model).subscribe(t=>{t&&(this.editMode=!this.editMode,this.model.setServiceAccountPassword(this.fakeServiceAccountPassword),this.isServiceAccountPasswordSet=!0,this.navigatToConfiguration())}),this.modelClone=j()(this.model)}get allowSave(){return this.model.isDirty&&this.model.isValid}setPasswordValue(t){this.model.setServiceAccountPassword(!0===t?this.model.password!==this.fakeServiceAccountPassword?this.model.password:"":""===this.model.password&&this.isServiceAccountPasswordSet?this.fakeServiceAccountPassword:this.model.password)}enableEditMode(){this.router.navigate([d.adConfigurationUrl])}navigatToConfiguration(){this.router.navigate([d.configurationUrl])}ngOnDestroy(){this.configSubscription&&this.configSubscription.unsubscribe(),this.editAdCredentialsSubscription&&this.editAdCredentialsSubscription.unsubscribe(),this.hotkeysService.remove(this.hotkeysService.hotkeys.filter(t=>"alt+t"===t.combo[0]||"esc"===t.combo[0]||"ctrl+s"===t.combo[0]))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(T),e.Y36(x.$),e.Y36(E.Y),e.Y36(v.F0),e.Y36(f.tm))},i.\u0275cmp=e.Xpm({type:i,selectors:[["collections-ad-configuration"]],outputs:{modelChanged:"modelChanged"},decls:20,vars:9,consts:[[3,"counter","title","description"],[3,"dataSource"],["table",""],["matColumnDef","svcaccount"],["class","pl-3 service-account-header",4,"matHeaderCellDef"],["class","text-left pl-3 pt-2 pb-2 service-account",4,"matCellDef"],["matColumnDef","password"],["class","pl-3 password-header",4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","fqdn"],["class","fqdn-header",4,"matHeaderCellDef"],["class","pl-0",4,"matHeaderRowDef"],["class","pl-0",4,"matRowDef","matRowDefColumns"],["class","container ad-credentials",4,"ngIf"],[1,"pre-footer","mb-0","mt-0","pt-1","pb-0","pl-2","pr-2"],[1,"footer"],["class","container footer-container",4,"ngIf"],[1,"pl-3","service-account-header"],[1,"text-left","pl-3","pt-2","pb-2","service-account"],[1,"pl-3","password-header"],[1,"fqdn-header"],[1,"pl-0"],[1,"container","ad-credentials"],[1,"row","mt-0","pointer","read-only","align-items-center",3,"click"],[1,"col","pt-3","pb-3"],[1,"col","pt-3","pb-3","left-border"],[4,"ngIf"],[1,"row","mt-0","pointer","align-items-center"],[1,"col","pt-0","pb-0"],[1,"full-width",3,"floatLabel"],["name","adServiceAccount","matInput","","placeholder","Service Account",3,"maxlength","formControl","ngModelChange"],[1,"col","pt-0","pb-0","left-border"],["matInput","","name","model.password","placeholder","Password","type","password",3,"formControl","ngModelChange","focus","blur"],["name","fqdn","matInput","","placeholder","Domain FQDN",3,"formControl","ngModelChange"],[1,"container","footer-container"],[3,"status","message","isSubmitEnabled","onCancel","onTest","onSubmit"]],template:function(t,o){1&t&&(e._UZ(0,"table-header",0),e.TgZ(1,"mat-table",1,2),e.ynx(3,3),e.YNc(4,ho,2,0,"mat-header-cell",4),e.YNc(5,po,1,0,"mat-cell",5),e.BQk(),e.ynx(6,6),e.YNc(7,go,2,0,"mat-header-cell",7),e.YNc(8,Co,1,0,"mat-cell",8),e.BQk(),e.ynx(9,9),e.YNc(10,fo,2,0,"mat-header-cell",10),e.YNc(11,_o,1,0,"mat-cell",8),e.BQk(),e.YNc(12,vo,1,0,"mat-header-row",11),e.YNc(13,bo,1,0,"mat-row",12),e.qZA(),e.YNc(14,wo,8,3,"div",13),e.YNc(15,yo,20,12,"div",13),e.TgZ(16,"p",14),e._uU(17," \xa0\n"),e.qZA(),e.TgZ(18,"div",15),e.YNc(19,ko,2,3,"div",16),e.qZA()),2&t&&(e.Q6J("counter",1)("title","AD CREDENTIALS"),e.xp6(1),e.Q6J("dataSource",e.DdM(8,Do)),e.xp6(11),e.Q6J("matHeaderRowDef",o.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumns),e.xp6(1),e.Q6J("ngIf",!o.editMode),e.xp6(1),e.Q6J("ngIf",o.editMode&&null!=o.modelClone),e.xp6(4),e.Q6J("ngIf",o.editMode))},directives:[le.a,r.BZ,r.w1,r.fO,r.ge,r.Dz,r.ev,r.as,r.XQ,r.nj,r.Gk,S.O5,_.KE,N.Nt,h.Fj,h.nD,h.JJ,h.oH,_.bx,_.TO,uo],styles:[".pre-footer[_ngcontent-%COMP%]{background-color:#e4e4e4;box-shadow:0 2px 2px #61616180}.service-account-header[_ngcontent-%COMP%]{max-width:325px}.service-account[_ngcontent-%COMP%]{max-width:230px}.password-header[_ngcontent-%COMP%]{max-width:345px}.fqdn-header[_ngcontent-%COMP%]{max-width:150px}.ad-credentials[_ngcontent-%COMP%]{background:#FFFFFF}.left-border[_ngcontent-%COMP%]{border-left:1px solid #E4E4E4}.footer[_ngcontent-%COMP%]{margin-top:2px}.footer-container[_ngcontent-%COMP%]{background:#EEEEEE;box-shadow:0 2px 2px #61616180}"]}),i})();var Io=s(59008);class No{constructor(){this.enableUpdates=!0,this.includeRecommendedUpdates=!0,this.enableMsUpdates=!0,this.includeOtherUpdates=!0}}function Po(i,a){1&i&&(e.TgZ(0,"mat-header-cell",20),e._uU(1,"Update "),e.qZA())}function Fo(i,a){1&i&&e._UZ(0,"mat-cell",21)}function qo(i,a){1&i&&e._UZ(0,"mat-header-cell")}function Eo(i,a){1&i&&e._UZ(0,"mat-cell",22)}function Lo(i,a){1&i&&e._UZ(0,"mat-header-row",23)}function Qo(i,a){1&i&&e._UZ(0,"mat-row",23)}const Jo=function(){return[]};let Yo=(()=>{class i{constructor(t,o,n){this.collectionSubject=t,this.collectionManagerHttpService=o,this.dataRepositoryService=n,this.displayedColumns=["name","value"],this.subscription=new w.w,this.model=new No}ngOnInit(){this.subscription.add(this.dataRepositoryService.currentEnvironmentSubject.pipe((0,b.h)(t=>null!=t)).subscribe(t=>this.environmentId=t.id)),this.subscription.add(this.collectionSubject.configurationLoaded.pipe((0,b.h)(t=>null!=t)).subscribe(t=>{this.model.enableMsUpdates=t.includeMsUpdates,this.model.includeRecommendedUpdates=t.includeRecommendedUpdates,this.model.includeOtherUpdates=t.includeOtherUpdates,this.model.enableUpdates=t.enableUpdates,this.modelClone=Io.G.cloneDeep(this.model)}))}ngAfterViewInit(){}onSettingChanged(t,o){this.model[t]=o.checked,this.collectionManagerHttpService.saveCollectionWindowsUpdatesConfiguration(this.environmentId,this.model.enableUpdates,this.model.enableMsUpdates,this.model.includeOtherUpdates,this.model.includeRecommendedUpdates).subscribe(()=>{})}ngOnDestroy(){this.subscription.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(T),e.Y36(x.$),e.Y36(E.Y))},i.\u0275cmp=e.Xpm({type:i,selectors:[["windows-update-collections"]],decls:28,vars:13,consts:[[3,"counter","title","description"],["body",""],[3,"dataSource"],["table",""],["matColumnDef","name"],["class","pl-3 name-cell",4,"matHeaderCellDef"],["class","text-left pl-3 pt-2 pb-2 name-cell",4,"matCellDef"],["matColumnDef","value"],[4,"matHeaderCellDef"],["class","text-left pt-2 pb-2 border-left",4,"matCellDef"],["class","pl-0",4,"matHeaderRowDef"],["class","pl-0",4,"matRowDef","matRowDefColumns"],["readonly-view",""],[1,"row","mt-0","pointer","no-gutters","align-items-center","background"],[1,"col","pt-2","pb-2","text-center"],["color","primary",3,"checked","change"],[1,"col","pt-3","pb-2","text-center","border-left"],["color","primary",3,"checked","disabled","change"],[1,"col","pt-3","pb-2","text-center"],[1,"pre-footer","mb-0","mt-0","pt-1","pb-0","pl-2","pr-2"],[1,"pl-3","name-cell"],[1,"text-left","pl-3","pt-2","pb-2","name-cell"],[1,"text-left","pt-2","pb-2","border-left"],[1,"pl-0"]],template:function(t,o){1&t&&(e.TgZ(0,"form-section",0),e.TgZ(1,"div",1),e.TgZ(2,"mat-table",2,3),e.ynx(4,4),e.YNc(5,Po,2,0,"mat-header-cell",5),e.YNc(6,Fo,1,0,"mat-cell",6),e.BQk(),e.ynx(7,7),e.YNc(8,qo,1,0,"mat-header-cell",8),e.YNc(9,Eo,1,0,"mat-cell",9),e.BQk(),e.YNc(10,Lo,1,0,"mat-header-row",10),e.YNc(11,Qo,1,0,"mat-row",11),e.qZA(),e.qZA(),e.TgZ(12,"div",12),e.TgZ(13,"div",13),e.TgZ(14,"div",14),e.TgZ(15,"mat-slide-toggle",15),e.NdJ("change",function(l){return o.onSettingChanged("enableUpdates",l)}),e._uU(16,"Windows updates"),e.qZA(),e.qZA(),e.TgZ(17,"div",16),e.TgZ(18,"mat-checkbox",17),e.NdJ("change",function(l){return o.onSettingChanged("enableMsUpdates",l)}),e._uU(19,"Include Microsoft updates"),e.qZA(),e.qZA(),e.TgZ(20,"div",18),e.TgZ(21,"mat-checkbox",17),e.NdJ("change",function(l){return o.onSettingChanged("includeRecommendedUpdates",l)}),e._uU(22,"Include recommended updates"),e.qZA(),e.qZA(),e.TgZ(23,"div",18),e.TgZ(24,"mat-checkbox",17),e.NdJ("change",function(l){return o.onSettingChanged("includeOtherUpdates",l)}),e._uU(25,"Include other updates"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(26,"p",19),e._uU(27," \xa0\n"),e.qZA()),2&t&&(e.Q6J("counter",2)("title","WINDOWS UPDATE"),e.xp6(2),e.Q6J("dataSource",e.DdM(12,Jo)),e.xp6(8),e.Q6J("matHeaderRowDef",o.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumns),e.xp6(4),e.Q6J("checked",o.model.enableUpdates),e.xp6(3),e.Q6J("checked",o.model.enableMsUpdates)("disabled",!o.model.enableUpdates),e.xp6(3),e.Q6J("checked",o.model.includeRecommendedUpdates)("disabled",!o.model.enableUpdates),e.xp6(3),e.Q6J("checked",o.model.includeOtherUpdates)("disabled",!o.model.enableUpdates))},directives:[k.A,r.BZ,r.w1,r.fO,r.ge,r.Dz,r.ev,r.as,r.XQ,r.nj,r.Gk,Ce.Rr,fe.oG],styles:[".name-cell[_ngcontent-%COMP%]{max-width:230px}.border-left[_ngcontent-%COMP%]{border-left:1px solid #E4E4E4}.background[_ngcontent-%COMP%]{background:#FFFFFF}"]}),i})(),be=(()=>{class i{constructor(t,o,n){this.collectionManagerService=t,this.dialogService=o,this.router=n,this.tabs=$.tabs,this.subscription=new w.w,this.isAdConfigurationUrlActive=this.router.url===d.adConfigurationUrl}ngOnInit(){this.collectionManagerService.fetchGlobalConfiguration(),this.subscription.add(this.collectionManagerService.adConfigurationUnsaved.pipe((0,b.h)(t=>null!=t)).subscribe(t=>this.adConfigurationUnsaved=t))}canDeactivate(){if(this.adConfigurationUnsaved&&null!=this.adConfigurationModel){const t=new u.xQ;return this.dialogService.openDialog("Do you want to save changes?","Your changes will be lost if you don't save them.",this.checkAdConfigurationRouteValidity()).subscribe(o=>{"Confirmed"===o?this.saveUnsavedChanges().subscribe(n=>{t.next(n)}):"UnConfirmed"===o?t.next(!0):"Canceled"===o&&t.next(!1)}),t.asObservable()}return!0}checkAdConfigurationRouteValidity(){return this.router.url!==d.adConfigurationUrl||null!=this.adConfigurationModel&&this.adConfigurationModel.isValid}saveUnsavedChanges(){if(this.router.url===d.adConfigurationUrl)return this.collectionManagerService.saveActiveDirectoryConfiguration(this.adConfigurationModel)}onDisabledAreaClick(){this.isAdConfigurationUrlActive&&this.router.navigate([d.configurationUrl])}ngOnDestroy(){this.subscription.unsubscribe()}onAdModelChanged(t){this.adConfigurationModel=t}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(T),e.Y36(G.S),e.Y36(v.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["collection-configuration"]],decls:7,vars:5,consts:[["body",""],[1,"container"],[1,"col-lg-11","offset-lg-1"],[3,"tabs","exact","forceActive"],[3,"modelChanged"],[3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"div",2),e._UZ(3,"am-page-tabs",3),e.TgZ(4,"collections-ad-configuration",4),e.NdJ("modelChanged",function(l){return o.onAdModelChanged(l)}),e.qZA(),e.TgZ(5,"div",5),e.NdJ("click",function(){return o.onDisabledAreaClick()}),e._UZ(6,"windows-update-collections"),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&t&&(e.xp6(3),e.Q6J("tabs",o.tabs)("exact",!0)("forceActive","/collections/config"),e.xp6(2),e.ekj("isDisabled",o.isAdConfigurationUrlActive))},directives:[W.a,Uo,Yo],styles:[""]}),i})();const Oo=[{path:"",pathMatch:"full",component:We},{path:d.configurationPath,children:[{path:"",component:be},{path:d.activeDirectoryPath,component:be,canDeactivate:[ve.I]}]},{path:":id",children:[{path:"",component:_e},{path:d.collectionInfoPath,component:_e,canDeactivate:[ve.I]}]}];let Ho=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[v.Bz.forChild(Oo)],v.Bz]}),i})(),Ro=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[S.ez,Se.U,we.b,Te.q,h.u5,h.UX,Q.Xd,Ho]]}),i})()}}]);